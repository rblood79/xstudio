import{r as d,u as m,a3 as T,af as k,ag as S,ah as D,h as v,a5 as F,a6 as x,j as i,P as G,ai as b,d as M,b as U,t as L}from"./index-CjM1KX21.js";const $=5,z=d.memo(function({pageId:n}){const a=m(e=>e.pages.find(t=>t.id===n)),l=m(e=>e.pages),f=T(e=>e.layouts),[y,P]=d.useState(null),_=a?.parent_id||"",j=d.useMemo(()=>l.find(e=>e.id===_),[l,_]),p=a?.slug||"",C=d.useMemo(()=>{if(!a)return"/";const e=a.layout_id?f.find(t=>t.id===a.layout_id):null;return k({page:{id:a.id,title:a.name,slug:a.slug,project_id:a.project_id,parent_id:a.parent_id,layout_id:a.layout_id,order_num:a.order_num},layout:e?{id:e.id,name:e.name,project_id:e.project_id,slug:e.slug||void 0}:null,allPages:l.map(t=>({id:t.id,title:t.name,slug:t.slug,project_id:t.project_id,parent_id:t.parent_id,layout_id:t.layout_id,order_num:t.order_num}))})},[a,l,f]),N=d.useMemo(()=>{const e=[{value:"",label:"No Parent (Root)"}],t=s=>{const g=l.filter(o=>o.parent_id===s),u=g.map(o=>o.id);return g.forEach(o=>{u.push(...t(o.id))}),u},c=t(n);return l.forEach(s=>{if(s.id===n||c.includes(s.id)||S(s.id,l.map(r=>({id:r.id,title:r.name,slug:r.slug,project_id:r.project_id,parent_id:r.parent_id,layout_id:r.layout_id,order_num:r.order_num})))+1>=$)return;const u=S(s.id,l.map(r=>({id:r.id,title:r.name,slug:r.slug,project_id:r.project_id,parent_id:r.parent_id,layout_id:r.layout_id,order_num:r.order_num}))),o="  ".repeat(u);e.push({value:s.id,label:`${o}${s.name}`})}),e},[l,n]),E=d.useCallback(async e=>{if(e&&D(n,e,l.map(t=>({id:t.id,title:t.name,slug:t.slug,project_id:t.project_id,parent_id:t.parent_id,layout_id:t.layout_id,order_num:t.order_num})))){console.error("âŒ Circular reference detected");return}console.log("ðŸ”— Page Parent changed:",{pageId:n,oldParentId:_,newParentId:e||null});try{const{pages:t,setPages:c}=m.getState(),s=await v(),g=t.map(u=>u.id===n?{...u,parent_id:e||null}:u);c(g),await s.pages.update(n,{parent_id:e||null}),console.log("âœ… Page parent updated successfully")}catch(t){console.error("âŒ Failed to update page parent:",t)}},[n,_,l]),h=d.useCallback(async e=>{const t=F(e);if(!t.isValid){P(t.error||"Invalid slug");return}P(null),console.log("ðŸ“ Page Slug changed:",{pageId:n,oldSlug:p,newSlug:e||null});try{const{pages:c,setPages:s}=m.getState(),g=await v(),u=c.map(o=>o.id===n?{...o,slug:e||null}:o);s(u),await g.pages.update(n,{slug:e||null}),console.log("âœ… Page slug updated successfully")}catch(c){console.error("âŒ Failed to update page slug:",c)}},[n,p]),R=d.useCallback(()=>{if(!a)return;const e=x(a.name);h(e)},[a,h]);return a?i.jsxs(G,{title:"Nested Routes",icon:b,children:[i.jsx(M,{label:"Parent Page",value:_,onChange:E,options:N,icon:b,description:j?`Child of "${j.name}"`:"This page is at root level"}),i.jsxs("div",{className:"page-slug-input",children:[i.jsx(U,{label:"Slug",value:p,onChange:h,placeholder:x(a.name),description:"URL path segment for this page"}),y&&i.jsxs("div",{className:"page-slug-error",children:[i.jsx(L,{size:12}),i.jsx("span",{children:y})]}),i.jsx("button",{type:"button",className:"page-slug-generate",onClick:R,title:"Generate slug from title",children:"Generate from Title"})]}),i.jsxs("div",{className:"page-url-preview",children:[i.jsx("span",{className:"page-url-label",children:"Preview URL:"}),i.jsx("code",{className:"page-url-value",children:C})]})]}):null});export{z as PageParentSelector,z as default};
