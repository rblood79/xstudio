import{D as A,aG as F,r as n,aH as k,aI as X,aJ as Q,aK as Z,aL as K,aM as L,aN as W,aO as ee,aP as v,aQ as O,aR as te,aS as G,aT as Y,aU as V,aV as J,aW as ie,aX as ae,aY as z,aZ as re,a_ as se,a$ as ne,j as t,b0 as le,b1 as oe,l as M,i as C,b2 as R,a5 as de,b3 as ce,u as P,B as he,q as D,a6 as ue,P as N,a as me,b as q,c as ge,H as fe}from"./index-s7MVcqKs.js";import{P as _}from"./labels-C7QIhqP9.js";import{LayoutSlugEditor as pe}from"./LayoutSlugEditor-B76tEfT5.js";import"./slugValidator-DYMUhltT.js";const xe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],ye=A("columns-2",xe);const be=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],$e=A("layout-dashboard",be);const we=[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]],ve=A("merge",we);let y=typeof document<"u"&&window.visualViewport;function Se(){let d=F(),[e,a]=n.useState(()=>d?{width:0,height:0}:I());return n.useEffect(()=>{let s=()=>{y&&y.scale>1||a(i=>{let l=I();return l.width===i.width&&l.height===i.height?i:l})},r,h=i=>{y&&y.scale>1||k(i.target)&&(r=requestAnimationFrame(()=>{(!document.activeElement||!k(document.activeElement))&&a(l=>{let c={width:window.innerWidth,height:window.innerHeight};return c.width===l.width&&c.height===l.height?l:c})}))};return window.addEventListener("blur",h,!0),y?y.addEventListener("resize",s):window.addEventListener("resize",s),()=>{cancelAnimationFrame(r),window.removeEventListener("blur",h,!0),y?y.removeEventListener("resize",s):window.removeEventListener("resize",s)}},[]),e}function I(){return{width:y?y.width*y.scale:window.innerWidth,height:y?y.height*y.scale:window.innerHeight}}function Ee(d,e,a){let{overlayProps:s,underlayProps:r}=X({...d,isOpen:e.isOpen,onClose:e.close},a);return Q({isDisabled:!e.isOpen}),Z(),n.useEffect(()=>{if(e.isOpen&&a.current)return K([a.current],{shouldUseInert:!0})},[e.isOpen,a]),{modalProps:L(s),underlayProps:r}}const Ce=n.forwardRef(function(e,a){[e,a]=W(e,a,ee);let{children:s,level:r=3,className:h,...i}=e,l=`h${r}`;return v.createElement(l,{...i,ref:a,className:h??"react-aria-Heading"},s)}),Pe=n.createContext(null),T=n.createContext(null),je=n.forwardRef(function(e,a){if(n.useContext(T))return v.createElement(B,{...e,modalRef:a},e.children);let{isDismissable:r,isKeyboardDismissDisabled:h,isOpen:i,defaultOpen:l,onOpenChange:c,children:o,isEntering:p,isExiting:u,UNSTABLE_portalContainer:x,shouldCloseOnInteractOutside:f,...$}=e;return v.createElement(Re,{isDismissable:r,isKeyboardDismissDisabled:h,isOpen:i,defaultOpen:l,onOpenChange:c,isEntering:p,isExiting:u,UNSTABLE_portalContainer:x,shouldCloseOnInteractOutside:f},v.createElement(B,{...$,modalRef:a},o))});function Ne(d,e){[d,e]=W(d,e,Pe);let a=n.useContext(O),s=ae(d),r=d.isOpen!=null||d.defaultOpen!=null||!a?s:a,h=G(e),i=n.useRef(null),l=z(h,r.isOpen),c=z(i,r.isOpen),o=l||c||d.isExiting||!1,p=F();return!r.isOpen&&!o||p?null:v.createElement(qe,{...d,state:r,isExiting:o,overlayRef:h,modalRef:i})}const Re=n.forwardRef(Ne);function qe({UNSTABLE_portalContainer:d,...e}){let a=e.modalRef,{state:s}=e,{modalProps:r,underlayProps:h}=Ee(e,s,a),i=Y(e.overlayRef)||e.isEntering||!1,l=V({...e,defaultClassName:"react-aria-ModalOverlay",values:{isEntering:i,isExiting:e.isExiting,state:s}}),c=Se(),o;if(typeof document<"u"){let u=re(document.body)?document.body:document.scrollingElement||document.documentElement,x=u.getBoundingClientRect().height%1;o=u.scrollHeight-x}let p={...l.style,"--visual-viewport-height":c.height+"px","--page-height":o!==void 0?o+"px":void 0};return v.createElement(se,{isExiting:e.isExiting,portalContainer:d},v.createElement("div",{...L(J(e,{global:!0}),h),...l,style:p,ref:e.overlayRef,"data-entering":i||void 0,"data-exiting":e.isExiting||void 0},v.createElement(ne,{values:[[T,{modalProps:r,modalRef:a,isExiting:e.isExiting,isDismissable:e.isDismissable}],[O,s]]},l.children)))}function B(d){let{modalProps:e,modalRef:a,isExiting:s,isDismissable:r}=n.useContext(T),h=n.useContext(O),i=n.useMemo(()=>te(d.modalRef,a),[d.modalRef,a]),l=G(i),c=Y(l),o=V({...d,defaultClassName:"react-aria-Modal",values:{isEntering:c,isExiting:s,state:h}});return v.createElement("div",{...L(J(d,{global:!0}),e),...o,ref:l,"data-entering":c||void 0,"data-exiting":s||void 0},r&&v.createElement(ie,{onDismiss:h.close}),o.children)}const Ae=n.memo(function({areas:e,width:a=120,height:s=80,selectedSlot:r}){const h=n.useMemo(()=>e.map(i=>{const l=r===i.name,c=i.required;let o;return l?o="var(--color-primary-200)":c?o="var(--color-primary-100)":i.isSlot?o="var(--color-gray-100)":o="var(--color-gray-50)",t.jsxs("g",{children:[t.jsx("rect",{x:`${i.x}%`,y:`${i.y}%`,width:`${i.width}%`,height:`${i.height}%`,fill:o,stroke:l?"var(--color-primary-500)":"var(--color-gray-300)",strokeWidth:l?2:1,rx:2}),i.width>=20&&i.height>=15&&t.jsx("text",{x:`${i.x+i.width/2}%`,y:`${i.y+i.height/2}%`,textAnchor:"middle",dominantBaseline:"middle",fill:"var(--color-gray-600)",fontSize:"8",fontFamily:"var(--font-sans)",children:i.name}),c&&i.width>=15&&t.jsx("text",{x:`${i.x+i.width-2}%`,y:`${i.y+4}%`,textAnchor:"end",fill:"var(--color-primary-600)",fontSize:"8",fontWeight:"bold",children:"*"})]},i.name)}),[e,r]);return t.jsx("svg",{width:a,height:s,viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"preset-preview-svg",style:{border:"1px solid var(--color-gray-200)",borderRadius:"var(--radius-sm)",backgroundColor:"var(--color-white)"},children:h})}),Le=n.memo(function({isOpen:e,existingSlots:a,presetName:s,onConfirm:r,onClose:h}){const i=a.some(p=>p.hasChildren),l=n.useCallback(()=>{r("replace")},[r]),c=n.useCallback(()=>{r("merge")},[r]),o=n.useCallback(()=>{r("cancel"),h()},[r,h]);return e?t.jsx(le,{isOpen:e,children:t.jsx(je,{isDismissable:!0,onOpenChange:p=>!p&&h(),className:"react-aria-Modal",children:t.jsxs(oe,{className:"react-aria-Dialog existing-slot-dialog",children:[t.jsxs(Ce,{slot:"title",className:"dialog-title",children:[t.jsx(M,{className:"icon-warning",size:C.size}),"기존 Slot이 있습니다"]}),t.jsxs("div",{className:"dialog-content",children:[t.jsxs("p",{className:"dialog-description",children:["“",s,"” 프리셋을 적용하려면 기존 Slot을 어떻게 처리할지 선택하세요."]}),t.jsxs("div",{className:"existing-slots-list",children:[t.jsxs("p",{className:"list-title",children:["현재 Slot (",a.length,"개):"]}),t.jsx("ul",{children:a.map(p=>t.jsxs("li",{children:[t.jsx("span",{className:"slot-name",children:p.slotName}),p.hasChildren&&t.jsx("span",{className:"slot-warning",children:"(콘텐츠 있음)"})]},p.elementId))})]}),i&&t.jsxs("div",{className:"warning-box",children:[t.jsx(M,{size:C.size}),t.jsx("span",{children:"일부 Slot에 콘텐츠가 있습니다. 덮어쓰기 시 삭제됩니다."})]})]}),t.jsxs("div",{className:"dialog-actions",children:[t.jsxs(R,{variant:"default",onPress:o,children:[t.jsx(de,{size:C.size}),"취소"]}),t.jsxs(R,{variant:"secondary",onPress:c,children:[t.jsx(ve,{size:C.size}),"병합 (새 Slot만 추가)"]}),t.jsxs(R,{variant:"primary",onPress:l,children:[t.jsx(ce,{size:C.size}),"덮어쓰기"]})]})]})})}):null}),E={fullscreen:{id:"fullscreen",name:"전체화면",description:"단일 전체 화면 콘텐츠",category:"basic",slots:[{name:"content",required:!0,description:"전체 화면 콘텐츠"}],containerStyle:{display:"flex",minHeight:"100vh"},previewAreas:[{name:"content",x:0,y:0,width:100,height:100,isSlot:!0,required:!0}]},"vertical-2":{id:"vertical-2",name:"수직 2단",description:"Header + Content",category:"basic",slots:[{name:"header",required:!1,description:"상단 헤더 영역"},{name:"content",required:!0,description:"메인 콘텐츠 영역"}],containerStyle:{display:"flex",flexDirection:"column",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:15,isSlot:!0},{name:"content",x:0,y:15,width:100,height:85,isSlot:!0,required:!0}]},"vertical-3":{id:"vertical-3",name:"수직 3단",description:"Header + Content + Footer",category:"basic",slots:[{name:"header",required:!1,description:"상단 헤더 영역"},{name:"content",required:!0,description:"메인 콘텐츠 영역"},{name:"footer",required:!1,description:"하단 푸터 영역"}],containerStyle:{display:"flex",flexDirection:"column",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:12,isSlot:!0},{name:"content",x:0,y:12,width:100,height:76,isSlot:!0,required:!0},{name:"footer",x:0,y:88,width:100,height:12,isSlot:!0}]},"sidebar-left":{id:"sidebar-left",name:"좌측 사이드바",description:"Sidebar + Content",category:"sidebar",slots:[{name:"sidebar",required:!1,description:"좌측 사이드바",defaultStyle:{width:"250px"}},{name:"content",required:!0,description:"메인 콘텐츠"}],containerStyle:{display:"flex",flexDirection:"row",minHeight:"100vh"},previewAreas:[{name:"sidebar",x:0,y:0,width:25,height:100,isSlot:!0},{name:"content",x:25,y:0,width:75,height:100,isSlot:!0,required:!0}]},"sidebar-right":{id:"sidebar-right",name:"우측 사이드바",description:"Content + Sidebar",category:"sidebar",slots:[{name:"content",required:!0,description:"메인 콘텐츠"},{name:"sidebar",required:!1,description:"우측 사이드바",defaultStyle:{width:"250px"}}],containerStyle:{display:"flex",flexDirection:"row",minHeight:"100vh"},previewAreas:[{name:"content",x:0,y:0,width:75,height:100,isSlot:!0,required:!0},{name:"sidebar",x:75,y:0,width:25,height:100,isSlot:!0}]},"holy-grail":{id:"holy-grail",name:"Holy Grail",description:"Header + (Sidebar + Content + Aside) + Footer",category:"complex",slots:[{name:"header",required:!1},{name:"sidebar",required:!1,defaultStyle:{width:"200px"}},{name:"content",required:!0},{name:"aside",required:!1,defaultStyle:{width:"200px"}},{name:"footer",required:!1}],containerStyle:{display:"grid",gridTemplateAreas:`
        "header header header"
        "sidebar content aside"
        "footer footer footer"
      `,gridTemplateColumns:"200px 1fr 200px",gridTemplateRows:"auto 1fr auto",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:12,isSlot:!0},{name:"sidebar",x:0,y:12,width:20,height:76,isSlot:!0},{name:"content",x:20,y:12,width:60,height:76,isSlot:!0,required:!0},{name:"aside",x:80,y:12,width:20,height:76,isSlot:!0},{name:"footer",x:0,y:88,width:100,height:12,isSlot:!0}]},"complex-3col":{id:"complex-3col",name:"3열 레이아웃",description:"Header + 3 Columns + Footer",category:"complex",slots:[{name:"header",required:!1},{name:"left",required:!1},{name:"content",required:!0},{name:"right",required:!1},{name:"footer",required:!1}],containerStyle:{display:"grid",gridTemplateAreas:`
        "header header header"
        "left content right"
        "footer footer footer"
      `,gridTemplateColumns:"1fr 2fr 1fr",gridTemplateRows:"auto 1fr auto",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:12,isSlot:!0},{name:"left",x:0,y:12,width:25,height:76,isSlot:!0},{name:"content",x:25,y:12,width:50,height:76,isSlot:!0,required:!0},{name:"right",x:75,y:12,width:25,height:76,isSlot:!0},{name:"footer",x:0,y:88,width:100,height:12,isSlot:!0}]},dashboard:{id:"dashboard",name:"대시보드",description:"Navigation + Sidebar + Main Content",category:"dashboard",slots:[{name:"navigation",required:!1,description:"상단 네비게이션"},{name:"sidebar",required:!1,description:"좌측 메뉴",defaultStyle:{width:"240px"}},{name:"content",required:!0,description:"대시보드 콘텐츠"}],containerStyle:{display:"grid",gridTemplateAreas:`
        "navigation navigation"
        "sidebar content"
      `,gridTemplateColumns:"240px 1fr",gridTemplateRows:"auto 1fr",minHeight:"100vh"},previewAreas:[{name:"navigation",x:0,y:0,width:100,height:10,isSlot:!0},{name:"sidebar",x:0,y:10,width:24,height:90,isSlot:!0},{name:"content",x:24,y:10,width:76,height:90,isSlot:!0,required:!0}]},"dashboard-widgets":{id:"dashboard-widgets",name:"대시보드 (위젯)",description:"Header + Sidebar + Main + Widgets Panel",category:"dashboard",slots:[{name:"header",required:!1},{name:"sidebar",required:!1},{name:"content",required:!0},{name:"widgets",required:!1}],containerStyle:{display:"grid",gridTemplateAreas:`
        "header header header"
        "sidebar content widgets"
      `,gridTemplateColumns:"200px 1fr 280px",gridTemplateRows:"auto 1fr",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:10,isSlot:!0},{name:"sidebar",x:0,y:10,width:20,height:90,isSlot:!0},{name:"content",x:20,y:10,width:52,height:90,isSlot:!0,required:!0},{name:"widgets",x:72,y:10,width:28,height:90,isSlot:!0}]}},Oe={basic:{label:"기본",icon:"Layout"},sidebar:{label:"사이드바",icon:"Columns2"},complex:{label:"복합",icon:"LayoutGrid"},dashboard:{label:"대시보드",icon:"LayoutDashboard"}},De=["fullscreen","vertical-2","vertical-3","sidebar-left","sidebar-right","holy-grail","complex-3col","dashboard","dashboard-widgets"];function Te({layoutId:d,bodyElementId:e}){const[a,s]=n.useState(!1),r=P(u=>u.elements),h=P(u=>u.addComplexElement),i=P(u=>u.removeElement),l=P(u=>u.updateElementProps),c=n.useMemo(()=>r.filter(u=>u.layout_id===d&&u.tag==="Slot").map(u=>{const x=r.some(f=>f.parent_id===u.id||f.props?.slot_name===u.props?.name);return{slotName:u.props?.name||"unnamed",elementId:u.id,hasChildren:x}}),[r,d]),o=n.useMemo(()=>{const u=r.find(f=>f.id===e);if(!u)return null;const x=u.props?.appliedPreset;if(x&&E[x]){const f=E[x],$=new Set(f.slots.map(b=>b.name)),g=new Set(c.map(b=>b.slotName));if(g.size===$.size&&[...g].every(b=>$.has(b)))return x}return null},[r,e,c]),p=n.useCallback(async(u,x)=>{if(x==="cancel")return;const f=E[u];if(!f){console.error(`[usePresetApply] Unknown preset: ${u}`);return}console.log(`[Preset] Applying "${f.name}" to layout ${d.slice(0,8)}...`),s(!0);try{x==="replace"&&c.length>0&&(console.log(`[Preset] Removing ${c.length} existing slots...`),await Promise.all(c.map(m=>i(m.elementId))),console.log(`[Preset] Removed ${c.length} existing slots`));const $=new Set(c.map(m=>m.slotName)),g=x==="merge"?f.slots.filter(m=>!$.has(m.name)):f.slots;if(g.length===0){console.log("[Preset] No new slots to create (all already exist)"),s(!1);return}console.log(`[Preset] Creating ${g.length} new slots...`);let b=1;const w=g.map(m=>({id:crypto.randomUUID(),tag:"Slot",props:{name:m.name,required:m.required,description:m.description,style:m.defaultStyle},parent_id:e,layout_id:d,page_id:null,order_num:b++})),j=r.find(m=>m.id===e);if(j){const m=j.props?.style||{},S=f.containerStyle?{...m,...f.containerStyle}:m;await l(e,{style:S,appliedPreset:u}),console.log(`[Preset] Saved appliedPreset="${u}" to body`)}if(w.length>0){const[m,...S]=w;await h(m,S),console.log(`[Preset] Created ${w.length} slots with single history entry`)}console.log(`[Preset] "${f.name}" applied successfully`)}catch($){throw console.error("[Preset] Failed to apply preset:",$),$}finally{s(!1)}},[d,e,c,r,h,i,l]);return{existingSlots:c,currentPresetKey:o,applyPreset:p,isApplying:a}}const He={basic:D,sidebar:ye,complex:he,dashboard:$e},ke=n.memo(function({layoutId:e,bodyElementId:a}){const[s,r]=n.useState(null),[h,i]=n.useState(!1),{existingSlots:l,currentPresetKey:c,applyPreset:o,isApplying:p}=Te({layoutId:e,bodyElementId:a}),u=n.useMemo(()=>{const g={basic:[],sidebar:[],complex:[],dashboard:[]};return De.forEach(b=>{const w=E[b];w&&g[w.category].push(b)}),g},[]),x=n.useCallback(g=>{if(c===g){console.log(`[Preset] "${g}" is already applied, skipping`);return}r(g),l.length>0?i(!0):o(g,"replace")},[l.length,c,o]),f=n.useCallback(g=>{s&&g!=="cancel"&&o(s,g),i(!1),r(null)},[s,o]),$=n.useCallback(()=>{i(!1),r(null)},[]);return t.jsxs(t.Fragment,{children:[Object.entries(Oe).map(([g,b])=>{const w=u[g];if(!w||w.length===0)return null;const j=He[g]||D;return t.jsxs("div",{className:"list-subgroup",children:[t.jsxs("div",{className:"list-subgroup-header",children:[t.jsx(j,{size:ue.size,className:"list-subgroup-icon"}),t.jsx("span",{className:"list-subgroup-title",children:b.label})]}),t.jsx("div",{className:"list-group",role:"list",children:w.map(m=>{const S=E[m];if(!S)return null;const U=s===m,H=c===m;return t.jsxs(R,{variant:"default",className:`list-item preset-card ${U?"selected":""} ${H?"applied":""}`,onPress:()=>x(m),isDisabled:p,children:[t.jsx(Ae,{areas:S.previewAreas,width:80,height:60}),t.jsx("span",{className:"list-item-name",children:S.name}),H&&t.jsx("span",{className:"list-item-badge applied",children:"적용됨"})]},m)})})]},g)}),t.jsx(Le,{isOpen:h,existingSlots:l,presetName:s&&E[s]?.name||"",onConfirm:f,onClose:$})]})}),Be=n.memo(function({elementId:e,currentProps:a,onUpdate:s}){const{customId:r,layoutId:h}=n.useMemo(()=>{const o=P.getState().elementsMap.get(e);return{customId:o?.customId||"",layoutId:o?.layout_id||null}},[e]),i=n.useCallback(o=>{s({...a,className:o||void 0})},[a,s]),l=n.useCallback(o=>{s({...a,"aria-label":o||void 0})},[a,s]),c=n.useCallback(o=>{s({...a,"aria-labelledby":o||void 0})},[a,s]);return t.jsxs(t.Fragment,{children:[t.jsx(N,{title:"Basic",children:t.jsx(me,{label:"ID",value:r,elementId:e,placeholder:"layout-body"})}),h&&t.jsx(N,{title:"Layout Preset",children:t.jsx(ke,{layoutId:h,bodyElementId:e})}),h&&t.jsx(pe,{layoutId:h}),t.jsx(N,{title:"Layout",children:t.jsx(q,{label:"Class Name",value:String(a.className||""),onChange:i,placeholder:"layout-container",icon:D})}),t.jsxs(N,{title:"Accessibility",children:[t.jsx(q,{label:_.ARIA_LABEL,value:String(a["aria-label"]||""),onChange:l,icon:ge,placeholder:"Layout content area"}),t.jsx(q,{label:_.ARIA_LABELLEDBY,value:String(a["aria-labelledby"]||""),onChange:c,icon:fe,placeholder:"ID of labeling element"})]})]})},(d,e)=>d.elementId===e.elementId&&JSON.stringify(d.currentProps)===JSON.stringify(e.currentProps));export{Be as LayoutBodyEditor,Be as default};
