import{r as g,u as y,$ as k,h as b,j as u,P as F,e as w,b as D,v as G,a0 as M}from"./index-nCH8xSW_.js";import{v as z,g as x}from"./slugValidator-DYMUhltT.js";import{F as C}from"./folder-tree-B6uDezae.js";function L({page:a,layout:l,allPages:e}){if(a.slug.startsWith("/"))return a.slug;if(l?.slug)return S(`${l.slug}/${a.slug}`);if(a.parent_id&&e){const n=N(a.parent_id,e);return S(`${n}/${a.slug}`)}return S(`/${a.slug}`)}function N(a,l){const e=l.find(n=>n.id===a);return e?e.slug.startsWith("/")?e.slug:e.parent_id?`${N(e.parent_id,l)}/${e.slug}`:`/${e.slug}`:""}function S(a){return a.replace(/\/+/g,"/")}function A(a,l,e){if(!l)return!1;let n=l;const c=new Set;for(;n;){if(n===a||c.has(n))return!0;c.add(n),n=e.find(h=>h.id===n)?.parent_id||null}return!1}function $(a,l){let e=0,n=a;for(;n;){const c=l.find(f=>f.id===n);if(!c?.parent_id)break;e++,n=c.parent_id}return e}const W=5,X=g.memo(function({pageId:l}){const e=y(t=>t.pages.find(r=>r.id===l)),n=y(t=>t.pages),c=k(t=>t.layouts),[f,h]=g.useState(null),m=e?.parent_id||"",v=g.useMemo(()=>n.find(t=>t.id===m),[n,m]),P=e?.slug||"",E=g.useMemo(()=>{if(!e)return"/";const t=e.layout_id?c.find(r=>r.id===e.layout_id):null;return L({page:{id:e.id,title:e.title,slug:e.slug,project_id:e.project_id,parent_id:e.parent_id,layout_id:e.layout_id,order_num:e.order_num},layout:t?{id:t.id,name:t.name,project_id:t.project_id,slug:t.slug||void 0}:null,allPages:n.map(r=>({id:r.id,title:r.title,slug:r.slug,project_id:r.project_id,parent_id:r.parent_id,layout_id:r.layout_id,order_num:r.order_num}))})},[e,n,c]),R=g.useMemo(()=>{const t=[{value:"",label:"No Parent (Root)"}],r=i=>{const p=n.filter(o=>o.parent_id===i),d=p.map(o=>o.id);return p.forEach(o=>{d.push(...r(o.id))}),d},_=r(l);return n.forEach(i=>{if(i.id===l||_.includes(i.id)||$(i.id,n.map(s=>({id:s.id,title:s.title,slug:s.slug,project_id:s.project_id,parent_id:s.parent_id,layout_id:s.layout_id,order_num:s.order_num})))+1>=W)return;const d=$(i.id,n.map(s=>({id:s.id,title:s.title,slug:s.slug,project_id:s.project_id,parent_id:s.parent_id,layout_id:s.layout_id,order_num:s.order_num}))),o="  ".repeat(d);t.push({value:i.id,label:`${o}${i.title}`})}),t},[n,l]),T=g.useCallback(async t=>{if(t&&A(l,t,n.map(r=>({id:r.id,title:r.title,slug:r.slug,project_id:r.project_id,parent_id:r.parent_id,layout_id:r.layout_id,order_num:r.order_num})))){console.error("âŒ Circular reference detected");return}console.log("ðŸ”— Page Parent changed:",{pageId:l,oldParentId:m,newParentId:t||null});try{const{pages:r,setPages:_}=y.getState(),i=await b(),p=r.map(d=>d.id===l?{...d,parent_id:t||null}:d);_(p),await i.pages.update(l,{parent_id:t||null}),console.log("âœ… Page parent updated successfully")}catch(r){console.error("âŒ Failed to update page parent:",r)}},[l,m,n]),j=g.useCallback(async t=>{const r=z(t);if(!r.valid){h(r.error||"Invalid slug");return}h(null),console.log("ðŸ“ Page Slug changed:",{pageId:l,oldSlug:P,newSlug:t||null});try{const{pages:_,setPages:i}=y.getState(),p=await b(),d=_.map(o=>o.id===l?{...o,slug:t||""}:o);i(d),await p.pages.update(l,{slug:t||""}),console.log("âœ… Page slug updated successfully")}catch(_){console.error("âŒ Failed to update page slug:",_)}},[l,P]),U=g.useCallback(()=>{if(!e)return;const t=x(e.title);j(t)},[e,j]);return e?u.jsxs(F,{title:"Nested Routes",icon:C,children:[u.jsx(w,{label:"Parent Page",value:m,onChange:T,options:R,icon:C,description:v?`Child of "${v.title}"`:"This page is at root level"}),u.jsxs("div",{className:"page-slug-input",children:[u.jsx(D,{label:"Slug",value:P,onChange:j,placeholder:x(e.title),description:"URL path segment for this page"}),f&&u.jsxs("div",{className:"page-slug-error",children:[u.jsx(G,{size:M.size}),u.jsx("span",{children:f})]}),u.jsx("button",{type:"button",className:"page-slug-generate",onClick:U,title:"Generate slug from title",children:"Generate from Title"})]}),u.jsxs("div",{className:"page-url-preview",children:[u.jsx("span",{className:"page-url-label",children:"Preview URL:"}),u.jsx("code",{className:"page-url-value",children:E})]})]}):null});export{X as PageParentSelector,X as default};
