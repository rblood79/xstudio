import{r as s,u as g,E as x,v as E}from"./index-eamGj-Vg.js";function P(b){const{elementId:l,childTag:t,defaultItemProps:c}=b,[h,o]=s.useState(null),{addElement:u,updateElementProps:i,setElements:p,currentPageId:I}=g(),a=g(e=>e.elements),d=s.useMemo(()=>a.filter(e=>e.parent_id===l&&e.tag===t).sort((e,r)=>(e.order_num||0)-(r.order_num||0)),[a,l,t]),$=s.useCallback(e=>{o(e)},[]),w=s.useCallback(()=>{o(null)},[]),C=s.useCallback(async()=>{try{const e=d.length,r=c?c(e):{label:`Item ${e+1}`,value:`item${e+1}`},m={id:x.generateId(),page_id:I||"1",tag:t,props:{...r,isDisabled:!1,style:{},className:""},parent_id:l,order_num:e+1},{data:n,error:f}=await E.from("elements").insert(m).select().single();if(f)throw f;if(!n)throw new Error("Failed to create element");u(n),console.log(`새 ${t} 추가됨:`,n)}catch(e){console.error(`${t} 추가 중 오류:`,e)}},[d.length,t,l,I,c,u]),_=s.useCallback(async e=>{try{const{error:r}=await E.from("elements").delete().eq("id",e);if(r){console.error(`${t} 삭제 에러:`,r);return}const m=a.filter(n=>n.id!==e);p(m),o(null),console.log(`${t} 삭제됨:`,e)}catch(r){console.error(`${t} 삭제 중 오류:`,r)}},[t,a,p]),k=s.useCallback((e,r)=>{i(e,r)},[i]);return{children:d,selectedItemIndex:h,setSelectedItemIndex:o,selectItem:$,deselectItem:w,addItem:C,deleteItem:_,updateItem:k}}export{P as u};
