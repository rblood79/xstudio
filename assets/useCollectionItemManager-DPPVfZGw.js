import{r,u as l,E as _,x as E}from"./index-Cdmzjkk6.js";function y(b){const{elementId:o,childTag:t,defaultItemProps:d}=b,[h,a]=r.useState(null),i=l(e=>e.addElement),p=l(e=>e.updateElementProps),I=l(e=>e.setElements),g=l(e=>e.currentPageId),c=l(e=>e.elements),m=r.useMemo(()=>c.filter(e=>e.parent_id===o&&e.tag===t).sort((e,s)=>(e.order_num||0)-(s.order_num||0)),[c,o,t]),$=r.useCallback(e=>{a(e)},[]),w=r.useCallback(()=>{a(null)},[]),x=r.useCallback(async()=>{try{const e=m.length,s=d?d(e):{label:`Item ${e+1}`,value:`item${e+1}`},u={id:_.generateId(),page_id:g||"1",tag:t,props:{...s,isDisabled:!1,style:{},className:""},parent_id:o,order_num:e+1},{data:n,error:f}=await E.from("elements").insert(u).select().single();if(f)throw f;if(!n)throw new Error("Failed to create element");i(n),console.log(`새 ${t} 추가됨:`,n)}catch(e){console.error(`${t} 추가 중 오류:`,e)}},[m.length,t,o,g,d,i]),C=r.useCallback(async e=>{try{const{error:s}=await E.from("elements").delete().eq("id",e);if(s){console.error(`${t} 삭제 에러:`,s);return}const u=c.filter(n=>n.id!==e);I(u),a(null),console.log(`${t} 삭제됨:`,e)}catch(s){console.error(`${t} 삭제 중 오류:`,s)}},[t,c,I]),P=r.useCallback((e,s)=>{p(e,s)},[p]);return{children:m,selectedItemIndex:h,setSelectedItemIndex:a,selectItem:$,deselectItem:w,addItem:x,deleteItem:C,updateItem:P}}export{y as u};
