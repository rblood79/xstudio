import{r as d,u as m,N as T,_ as U,$ as S,a0 as k,f as v,Q as D,U as x,j as i,P as F,a1 as b,c as G,b as M,s as $}from"./index-BH5HBUqa.js";const L=5,z=d.memo(function({pageId:s}){const a=m(e=>e.pages.find(t=>t.id===s)),l=m(e=>e.pages),f=T(e=>e.layouts),[y,P]=d.useState(null),_=a?.parent_id||"",j=d.useMemo(()=>l.find(e=>e.id===_),[l,_]),p=a?.slug||"",C=d.useMemo(()=>{if(!a)return"/";const e=a.layout_id?f.find(t=>t.id===a.layout_id):null;return U({page:{id:a.id,title:a.name,slug:a.slug,project_id:a.project_id,parent_id:a.parent_id,layout_id:a.layout_id,order_num:a.order_num},layout:e?{id:e.id,name:e.name,project_id:e.project_id,slug:e.slug||void 0}:null,allPages:l.map(t=>({id:t.id,title:t.name,slug:t.slug,project_id:t.project_id,parent_id:t.parent_id,layout_id:t.layout_id,order_num:t.order_num}))})},[a,l,f]),N=d.useMemo(()=>{const e=[{value:"",label:"No Parent (Root)"}],t=n=>{const g=l.filter(o=>o.parent_id===n),u=g.map(o=>o.id);return g.forEach(o=>{u.push(...t(o.id))}),u},c=t(s);return l.forEach(n=>{if(n.id===s||c.includes(n.id)||S(n.id,l.map(r=>({id:r.id,title:r.name,slug:r.slug,project_id:r.project_id,parent_id:r.parent_id,layout_id:r.layout_id,order_num:r.order_num})))+1>=L)return;const u=S(n.id,l.map(r=>({id:r.id,title:r.name,slug:r.slug,project_id:r.project_id,parent_id:r.parent_id,layout_id:r.layout_id,order_num:r.order_num}))),o="  ".repeat(u);e.push({value:n.id,label:`${o}${n.name}`})}),e},[l,s]),E=d.useCallback(async e=>{if(e&&k(s,e,l.map(t=>({id:t.id,title:t.name,slug:t.slug,project_id:t.project_id,parent_id:t.parent_id,layout_id:t.layout_id,order_num:t.order_num})))){console.error("âŒ Circular reference detected");return}console.log("ðŸ”— Page Parent changed:",{pageId:s,oldParentId:_,newParentId:e||null});try{const{pages:t,setPages:c}=m.getState(),n=await v(),g=t.map(u=>u.id===s?{...u,parent_id:e||null}:u);c(g),await n.pages.update(s,{parent_id:e||null}),console.log("âœ… Page parent updated successfully")}catch(t){console.error("âŒ Failed to update page parent:",t)}},[s,_,l]),h=d.useCallback(async e=>{const t=D(e);if(!t.isValid){P(t.error||"Invalid slug");return}P(null),console.log("ðŸ“ Page Slug changed:",{pageId:s,oldSlug:p,newSlug:e||null});try{const{pages:c,setPages:n}=m.getState(),g=await v(),u=c.map(o=>o.id===s?{...o,slug:e||null}:o);n(u),await g.pages.update(s,{slug:e||null}),console.log("âœ… Page slug updated successfully")}catch(c){console.error("âŒ Failed to update page slug:",c)}},[s,p]),R=d.useCallback(()=>{if(!a)return;const e=x(a.name);h(e)},[a,h]);return a?i.jsxs(F,{title:"Nested Routes",icon:b,children:[i.jsx(G,{label:"Parent Page",value:_,onChange:E,options:N,icon:b,description:j?`Child of "${j.name}"`:"This page is at root level"}),i.jsxs("div",{className:"page-slug-input",children:[i.jsx(M,{label:"Slug",value:p,onChange:h,placeholder:x(a.name),description:"URL path segment for this page"}),y&&i.jsxs("div",{className:"page-slug-error",children:[i.jsx($,{size:12}),i.jsx("span",{children:y})]}),i.jsx("button",{type:"button",className:"page-slug-generate",onClick:R,title:"Generate slug from title",children:"Generate from Title"})]}),i.jsxs("div",{className:"page-url-preview",children:[i.jsx("span",{className:"page-url-label",children:"Preview URL:"}),i.jsx("code",{className:"page-url-value",children:C})]})]}):null});export{z as PageParentSelector,z as default};
