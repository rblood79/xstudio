# 11. Canvas Resize Optimization 리뷰 노트

> 패널 토글 시 renderer.resize 호출을 줄이고 FPS 저하를 완화하기 위한 설계 초안을 검토한 내용입니다. 성능 측정 스크립트(`scripts/panel-toggle-perf.ts`) 결과와 연동해 확인해야 할 포인트, 추가 제안, 오픈 이슈를 정리했습니다.

## 1. 주요 확인사항 (기존 설계 검토)
- **테스트 시나리오 분리**: 고해상도(4K)·저해상도 각각에 대해 baseline vs resize 쓰로틀 적용 시나리오를 동일한 패널 토글 횟수(50회)와 간격(기본 120ms)으로 비교하고, FPS·resize 호출 수·GC 이벤트를 모두 기록하는 것으로 이해했습니다.
- **측정 지표**: 평균/최대 FPS, resize 호출 횟수 및 토글당 호출 비율, GC 이벤트 수·총 소요시간, 강제 GC(옵션) 시간을 함께 수집하는 구성은 합의된 목표치(예: 55 FPS+, 토글당 resize ≤ 1회)와 맞습니다.
- **결과 리포트**: JSON 결과와 Chart.js 기반 HTML 그래프를 생성해 baseline과 쓰로틀 적용 결과를 비교하도록 한 점은 QA 공유에 충분해 보입니다.

## 2. 추가 제안
- **패널 라벨 디폴트 명확화**: `--panel` 기본값이 `"속성|Properties"` 정규식 패턴이므로, 속성 패널 이외의 다른 패널을 측정할 때는 예시를 문서에 명시하거나, CLI 도움말(`--help`) 출력에 포함하는 것이 혼선 방지에 좋습니다.
- **디바이스 픽셀 비율 캡처**: 고해상도/저해상도 비교 시 `devicePixelRatio`를 결과 요약에 포함시키고 리포트에도 표시하면, 동일 해상도라도 DPR 차이로 인한 GPU 부하를 추적하기 쉽습니다.
- **쓰로틀 구간 다양화**: 현재 50ms 고정 쓰로틀만 비교하는데, 33ms(약 30 FPS), 67ms(약 15 FPS) 정도를 추가해 토글 UX 영향과 호출 감소 효과를 곡선으로 보는 것도 임계값 합의에 도움이 될 수 있습니다.
- **GC 옵저버 폴백**: 일부 브라우저/실행 환경에서 `PerformanceObserver` GC 이벤트가 비활성화될 수 있으므로, 수집 불가 시 명시적으로 플래그(예: `gcSupported: false`)를 결과 JSON에 기록해 리포트에서 안내문구를 표시하는 것을 권장합니다.
- **리사이즈 호출 타임라인 표시**: 리포트 그래프에 `resize` 타임스탬프를 점 형태로 겹쳐서 표시하면, 쓰로틀 적용 전후 호출이 몰리는 구간(버스트)을 시각적으로 파악하기 쉬워집니다.

## 3. 오픈 이슈 / 확인 필요 사항
- **강제 GC 실행 여부**: 현재 스크립트에서 강제 GC를 지원하는 환경(`--expose-gc`)과 일반 환경의 결과를 어떻게 구분·표기할지 합의가 필요합니다. (예: `forcedGcDurationMs`가 `null`이면 "지원 안함"으로 명시)
- **토글 인터벌 조정 실험**: 120ms 인터벌이 너무 짧아 UI 트랜지션이 겹칠 경우 실제 사용자 체감과 다를 수 있으므로, 120/200/300ms로 세트 테스트를 돌려 결과가 크게 변동하는지 확인이 필요합니다.
- **CI 연동 범위**: E2E 성능 측정을 CI에서 실행할 경우 GPU 지원 여부에 따라 결과 편차가 커질 수 있습니다. 최소한 로컬/성능 전용 러너에서만 수행하도록 문서에 범위를 명확히 적어두면 좋겠습니다.

## 4. 제안 액션 아이템
- CLI `--help` 추가 및 README(성능 스크립트 섹션)에 사용 예시 보강.
- 결과 JSON 스키마에 `devicePixelRatio`, `gcSupported` 필드 추가하고 HTML 리포트에 노출.
- 쓰로틀 값 파라미터화(`--throttle` 여러 값 수용 또는 배열 입력) 후, 리포트 그래프를 여러 곡선으로 표시.
- 리포트에 `resize` 이벤트 타임라인 및 GC 이벤트 마커 옵션 추가.
- 강제 GC 지원 여부 문구 및 인터벌별 테스트 매트릭스 표를 문서화.

---
*리뷰/코멘트는 요청에 따라 한국어로 작성했습니다.*
