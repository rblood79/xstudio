import{D as De,r as t,u as x,ak as Le,g as ne,E as se,h as oe,j as l,P as u,a as ye,b as g,T as ce,F as Fe,l as Me,e as de,al as we,d as I,t as Ae,am as Te,R as _e,an as he,S as Oe,y as Re,I as Ve,J as ze,ao as $e,i as C,c as We,H as me,f as qe,w as Ge}from"./index-s7MVcqKs.js";import{P as o}from"./labels-C7QIhqP9.js";import{u as He}from"./useCollectionItemManager-CcrocUgG.js";import{S as Ye}from"./square-x-BpPAWBI5.js";import{P as re}from"./pointer-off-BEwmFlZq.js";import{F as Je}from"./focus-Ct5JFPbk.js";import{B as Qe}from"./binary-CNsLaxXM.js";const Xe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 12h18",key:"1i2n21"}]],Ze=De("rows-2",Xe),na=t.memo(function({elementId:c,currentProps:a,onUpdate:n}){const{children:d,selectedItemIndex:y,selectItem:F,deselectItem:B,addItem:M,deleteItem:ge,updateItem:f}=He({elementId:c,childTag:"ListBoxItem",defaultItemProps:e=>({label:`Item ${e+1}`,value:`item${e+1}`})}),w=t.useMemo(()=>x.getState().elementsMap.get(c)?.customId||"",[c]),k=x(e=>e.addElement),A=x(e=>e.removeElement),T=x(e=>e.currentPageId),N=t.useMemo(()=>{const e=a.dataBinding;return!e||e.source!=="dataTable"||!e.name?null:e.name},[a.dataBinding]),_=Le(),h=t.useMemo(()=>N&&_.find(e=>e.name===N)||null,[_,N])?.schema||null,j=t.useCallback(()=>x.getState().elements.filter(e=>e.parent_id===c),[c])().find(i=>i.tag==="ListBoxItem"),m=j?.id?x.getState().elements.filter(e=>e.parent_id===j.id&&e.tag==="Field").sort((e,i)=>(e.order_num||0)-(i.order_num||0)):[],O=t.useCallback((e,i)=>{const s=e.toLowerCase();return s.includes("email")?"email":s.includes("url")||s.includes("link")||s.includes("website")?"url":s.includes("avatar")||s.includes("image")||s.includes("photo")||s.includes("picture")?"image":s.includes("date")||s.includes("created")||s.includes("updated")||s.includes("time")?"date":i==="boolean"?"boolean":i==="number"?"number":i==="date"||i==="datetime"?"date":i==="email"?"email":i==="url"?"url":i==="image"?"image":"string"},[]),R=t.useCallback(async()=>{if(!h||h.length===0){alert("DataTableì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");return}const e=T;if(!e){alert("íŽ˜ì´ì§€ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.");return}let i=j?.id;if(!i){const{elements:r}=x.getState(),D=Math.max(0,...d.map(S=>S.order_num||0)),L={id:se.generateId(),customId:ne("ListBoxItem",r),page_id:e,tag:"ListBoxItem",props:{style:{},className:""},parent_id:c,order_num:D+1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};try{const te=await(await oe()).elements.insert(L);k(te),i=te.id,console.log("âœ… [IndexedDB] ListBoxItem created for auto-generate")}catch(S){console.error("âŒ [IndexedDB] Failed to create ListBoxItem:",S),alert("ListBoxItem ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");return}}if(m.length>0&&!window.confirm(`ê¸°ì¡´ ${m.length}ê°œì˜ Fieldê°€ ìžˆìŠµë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±í•˜ë©´ ê¸°ì¡´ FieldëŠ” ìœ ì§€ë©ë‹ˆë‹¤.
ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;const{elements:s}=x.getState(),b=await oe();let v=m.length>0?Math.max(...m.map(r=>r.order_num||0))+1:1;for(const r of h){const D=O(r.key,r.type),L={id:se.generateId(),customId:ne("Field",s),page_id:e,tag:"Field",props:{key:r.key,label:r.label||r.key,type:D,showLabel:!0,visible:!0,style:{},className:""},parent_id:i,order_num:v++,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};try{const S=await b.elements.insert(L);k(S)}catch(S){console.error(`âŒ [IndexedDB] Failed to create Field for ${r.key}:`,S)}}console.log(`âœ… [Auto-Generate] ${h.length}ê°œì˜ Fieldê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`),alert(`${h.length}ê°œì˜ Fieldê°€ ìžë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`)},[h,T,j,m,d,c,k,O]);t.useEffect(()=>{B()},[c,B]);const V=t.useCallback(e=>{n({...a,label:e||void 0})},[a,n]),z=t.useCallback(e=>{n({...a,description:e||void 0})},[a,n]),$=t.useCallback(e=>{n({...a,errorMessage:e||void 0})},[a,n]),W=t.useCallback(e=>{n({...a,selectionMode:e})},[a,n]),q=t.useCallback(e=>{n({...a,disallowEmptySelection:e})},[a,n]),G=t.useCallback(e=>{n({...a,isRequired:e})},[a,n]),H=t.useCallback(e=>{n({...a,isDisabled:e})},[a,n]),Y=t.useCallback(e=>{n({...a,autoFocus:e})},[a,n]),J=t.useCallback(e=>{n({...a,name:e||void 0})},[a,n]),Q=t.useCallback(e=>{n({...a,validationBehavior:e})},[a,n]),X=t.useCallback(e=>{n({...a,"aria-label":e||void 0})},[a,n]),Z=t.useCallback(e=>{n({...a,"aria-labelledby":e||void 0})},[a,n]),K=t.useCallback(e=>{n({...a,"aria-describedby":e||void 0})},[a,n]),p=t.useCallback(async e=>{const i=a.dataBinding,s=i?.source==="dataTable"?i.name:null,b=e?.source==="dataTable"?e.name:null;if(s&&b&&s!==b&&m.length>0&&window.confirm(`DataTableì´ "${s}"ì—ì„œ "${b}"ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
ê¸°ì¡´ ${m.length}ê°œì˜ Fieldë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?

[í™•ì¸]: Field ì‚­ì œ í›„ ìƒˆ DataTable ì ìš©
[ì·¨ì†Œ]: Field ìœ ì§€í•˜ê³  DataTableë§Œ ë³€ê²½`)){for(const r of m)await A(r.id);console.log(`ðŸ—‘ï¸ [DataBinding] ${m.length}ê°œì˜ Fieldê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`)}n({...a,dataBinding:e||void 0})},[a,n,m,A]),U=t.useCallback(e=>{n({...a,enableVirtualization:e})},[a,n]),P=t.useCallback(e=>{const i=parseInt(e,10);!isNaN(i)&&i>0&&n({...a,height:i})},[a,n]),ee=t.useCallback(e=>{const i=parseInt(e,10);!isNaN(i)&&i>=0&&n({...a,overscan:i})},[a,n]),ae=t.useCallback(e=>{n({...a,filterText:e||void 0})},[a,n]),le=t.useCallback(e=>{const i=e.split(",").map(s=>s.trim()).filter(s=>s.length>0);n({...a,filterFields:i.length>0?i:void 0})},[a,n]),ie=t.useCallback(e=>{const i=x.getState().updateElement;i&&c&&i(c,{customId:e})},[c]),be=t.useCallback((e,i)=>{const s=d.find(v=>v.id===e);if(!s)return;const b={...s.props,label:i};f(e,b)},[d,f]),ue=t.useCallback((e,i)=>{const s=d.find(v=>v.id===e);if(!s)return;const b={...s.props,value:i};f(e,b)},[d,f]),xe=t.useCallback((e,i)=>{const s=d.find(v=>v.id===e);if(!s)return;const b={...s.props,isDisabled:i};f(e,b)},[d,f]),Ce=t.useMemo(()=>l.jsx(u,{title:"Basic",children:l.jsx(ye,{label:"ID",value:w,elementId:c,onChange:ie,placeholder:"listbox_1"})}),[w,c,ie]),ve=t.useMemo(()=>l.jsxs(u,{title:"Content",children:[l.jsx(g,{label:o.LABEL,value:String(a.label||""),onChange:V,icon:ce}),l.jsx(g,{label:o.DESCRIPTION,value:String(a.description||""),onChange:z,icon:Fe}),l.jsx(g,{label:o.ERROR_MESSAGE,value:String(a.errorMessage||""),onChange:$,icon:Me})]}),[a.label,a.description,a.errorMessage,V,z,$]),Se=t.useMemo(()=>l.jsxs(u,{title:"State",children:[l.jsx(de,{label:o.SELECTION_MODE,value:String(a.selectionMode||"single"),onChange:W,options:[{value:"single",label:o.SELECTION_MODE_SINGLE},{value:"multiple",label:o.SELECTION_MODE_MULTIPLE}],icon:we}),l.jsx(I,{label:o.DISALLOW_EMPTY_SELECTION,isSelected:!!a.disallowEmptySelection,onChange:q,icon:Ye}),l.jsx(I,{label:o.REQUIRED,isSelected:!!a.isRequired,onChange:G,icon:Ae})]}),[a.selectionMode,a.disallowEmptySelection,a.isRequired,W,q,G]),fe=t.useMemo(()=>l.jsxs(u,{title:"Behavior",children:[l.jsx(I,{label:o.DISABLED,isSelected:!!a.isDisabled,onChange:H,icon:re}),l.jsx(I,{label:o.AUTO_FOCUS,isSelected:!!a.autoFocus,onChange:Y,icon:Je})]}),[a.isDisabled,a.autoFocus,H,Y]),Ie=t.useMemo(()=>l.jsxs(u,{title:"Performance",children:[l.jsx(I,{label:"ê°€ìƒí™” í™œì„±í™”",isSelected:!!a.enableVirtualization,onChange:U,icon:Te}),!!a.enableVirtualization&&l.jsxs(l.Fragment,{children:[l.jsx(g,{label:"ì»¨í…Œì´ë„ˆ ë†’ì´ (px)",value:String(a.height||300),onChange:P,icon:_e,placeholder:"300"}),l.jsx(g,{label:"Overscan (ì¶”ê°€ ë Œë”)",value:String(a.overscan||5),onChange:ee,icon:Ze,placeholder:"5"}),l.jsx("p",{className:"section-overview-help",children:"ðŸ’¡ ê°€ìƒí™” í™œì„±í™” ì‹œ 10,000+ ì•„ì´í…œë„ ì›í™œí•˜ê²Œ ì²˜ë¦¬ë©ë‹ˆë‹¤"})]})]}),[a.enableVirtualization,a.height,a.overscan,U,P,ee]),je=t.useMemo(()=>l.jsxs(u,{title:"Filtering",icon:he,children:[l.jsx(g,{label:"í•„í„° í…ìŠ¤íŠ¸",value:String(a.filterText||""),onChange:ae,icon:Oe,placeholder:"ê²€ìƒ‰ì–´ ìž…ë ¥..."}),l.jsx(g,{label:"í•„í„° ëŒ€ìƒ í•„ë“œ",value:Array.isArray(a.filterFields)?a.filterFields.join(", "):"",onChange:le,icon:he,placeholder:"label, name, title"}),l.jsx("p",{className:"section-overview-help",children:"ðŸ’¡ í•„í„° ëŒ€ìƒ í•„ë“œê°€ ë¹„ì–´ìžˆìœ¼ë©´ ê¸°ë³¸ê°’ (label, name, title) ì‚¬ìš©"})]}),[a.filterText,a.filterFields,ae,le]),Ee=t.useMemo(()=>l.jsxs(u,{title:"Form Integration",children:[l.jsx(g,{label:o.NAME,value:String(a.name||""),onChange:J,icon:Re,placeholder:"listbox-name"}),l.jsx(de,{label:o.VALIDATION_BEHAVIOR,value:String(a.validationBehavior||"native"),onChange:Q,options:[{value:"native",label:"Native"},{value:"aria",label:"ARIA"}]})]}),[a.name,a.validationBehavior,J,Q]),Be=t.useMemo(()=>l.jsxs(u,{title:"Data Binding",icon:Ve,children:[l.jsx(ze,{label:"ë°ì´í„° ì†ŒìŠ¤",value:a.dataBinding,onChange:p}),h&&h.length>0&&l.jsxs("div",{className:"auto-generate-section",children:[l.jsxs("div",{className:"schema-info",children:[l.jsxs("p",{className:"tab-overview-text",children:["ðŸ“‹ ",h.length,"ê°œì˜ ì»¬ëŸ¼ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤"]}),l.jsxs("div",{className:"schema-columns",children:[h.slice(0,5).map(e=>l.jsxs("span",{className:"schema-column-tag",children:[e.label||e.key," (",e.type,")"]},e.key)),h.length>5&&l.jsxs("span",{className:"schema-column-more",children:["+",h.length-5,"ê°œ ë”"]})]})]}),l.jsx("div",{className:"tab-actions",children:l.jsxs("button",{className:"control-button add",onClick:R,children:[l.jsx($e,{color:C.color,strokeWidth:C.strokeWidth,size:C.size}),"Field ìžë™ ìƒì„±"]})}),m.length>0&&l.jsxs("p",{className:"section-overview-help",children:["âœ… í˜„ìž¬ ",m.length,"ê°œì˜ Fieldê°€ ìžˆìŠµë‹ˆë‹¤"]})]})]}),[a.dataBinding,p,h,m,R]),ke=t.useMemo(()=>l.jsxs(u,{title:"Accessibility",children:[l.jsx(g,{label:o.ARIA_LABEL,value:String(a["aria-label"]||""),onChange:X,icon:We,placeholder:"ListBox label for screen readers"}),l.jsx(g,{label:o.ARIA_LABELLEDBY,value:String(a["aria-labelledby"]||""),onChange:Z,icon:me,placeholder:"label-element-id"}),l.jsx(g,{label:o.ARIA_DESCRIBEDBY,value:String(a["aria-describedby"]||""),onChange:K,icon:me,placeholder:"description-element-id"})]}),[a,X,Z,K]),Ne=t.useMemo(()=>l.jsxs(u,{title:o.ITEM_MANAGEMENT,children:[l.jsxs("div",{className:"tab-overview",children:[l.jsxs("p",{className:"tab-overview-text",children:["Total items: ",d.length||0]}),l.jsx("p",{className:"section-overview-help",children:"ðŸ’¡ Select individual items from list to edit label, value, and state"})]}),d.length>0&&l.jsx("div",{className:"react-aria-ListBox",children:d.map((e,i)=>l.jsxs("div",{className:"react-aria-ListBoxItem",children:[l.jsx("span",{className:"tab-title",children:String(e.props.label||`Item ${i+1}`)}),l.jsx("button",{className:"tab-edit-button",onClick:()=>F(i),children:"Edit"})]},e.id))}),l.jsx("div",{className:"tab-actions",children:l.jsxs("button",{className:"control-button add",onClick:M,children:[l.jsx(qe,{color:C.color,strokeWidth:C.strokeWidth,size:C.size}),"Add Item"]})})]}),[d,F,M]);if(y!==null){const e=d[y];return e?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"properties-aria",children:[l.jsx(g,{label:o.LABEL,value:String(e.props.label||""),onChange:i=>be(e.id,i),icon:ce}),l.jsx(g,{label:o.VALUE,value:String(e.props.value||""),onChange:i=>ue(e.id,i),icon:Qe}),l.jsx(I,{label:o.DISABLED,isSelected:!!e.props.isDisabled,onChange:i=>xe(e.id,i),icon:re}),l.jsx("div",{className:"tab-actions",children:l.jsxs("button",{className:"control-button delete",onClick:()=>ge(e.id),children:[l.jsx(Ge,{color:C.color,strokeWidth:C.strokeWidth,size:C.size}),"Delete This Item"]})})]}),l.jsx("div",{className:"tab-actions",children:l.jsx("button",{className:"control-button secondary",onClick:B,children:"Back to ListBox Settings"})})]}):null}return l.jsxs(l.Fragment,{children:[Ce,ve,Be,Ie,je,Se,fe,Ee,ke,Ne]})},(E,c)=>E.elementId===c.elementId&&JSON.stringify(E.currentProps)===JSON.stringify(c.currentProps));export{na as ListBoxEditor};
