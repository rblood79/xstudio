/**
 * Events Panel 스타일
 *
 * 블록 기반 UI를 위한 CSS 토큰 및 컴포넌트 스타일
 * 설계 문서: docs/EVENTS_PANEL_REDESIGN.md (섹션 6)
 */

/* ============================================================================
   색상 토큰 (Block Colors)
   ============================================================================ */

:root {
  /* WHEN Block (Trigger) - Blue */
  --event-trigger-bg: #eff6ff;
  --event-trigger-border: #3b82f6;
  --event-trigger-icon: #2563eb;
  --event-trigger-text: #1e40af;

  /* IF Block (Condition) - Amber */
  --event-condition-bg: #fffbeb;
  --event-condition-border: #f59e0b;
  --event-condition-icon: #d97706;
  --event-condition-text: #92400e;

  /* THEN Block (Success) - Green */
  --event-success-bg: #ecfdf5;
  --event-success-border: #10b981;
  --event-success-icon: #059669;
  --event-success-text: #065f46;

  /* ELSE Block (Fallback) - Red */
  --event-fallback-bg: #fef2f2;
  --event-fallback-border: #ef4444;
  --event-fallback-icon: #dc2626;
  --event-fallback-text: #991b1b;

  /* Action Block - Gray */
  --event-action-bg: #f9fafb;
  --event-action-border: #d1d5db;
  --event-action-icon: #6b7280;
  --event-action-text: #374151;

  /* Connector */
  --event-connector-color: #9ca3af;
  --event-connector-width: 2px;

  /* Block Layout */
  --event-block-radius: 8px;
  --event-block-padding: 12px;
  --event-block-gap: 8px;
}

/* Dark mode overrides */
[data-theme="dark"] {
  /* WHEN Block - Blue (Dark) */
  --event-trigger-bg: #1e3a5f;
  --event-trigger-border: #60a5fa;
  --event-trigger-icon: #93c5fd;
  --event-trigger-text: #bfdbfe;

  /* IF Block - Amber (Dark) */
  --event-condition-bg: #451a03;
  --event-condition-border: #fbbf24;
  --event-condition-icon: #fcd34d;
  --event-condition-text: #fef3c7;

  /* THEN Block - Green (Dark) */
  --event-success-bg: #064e3b;
  --event-success-border: #34d399;
  --event-success-icon: #6ee7b7;
  --event-success-text: #d1fae5;

  /* ELSE Block - Red (Dark) */
  --event-fallback-bg: #450a0a;
  --event-fallback-border: #f87171;
  --event-fallback-icon: #fca5a5;
  --event-fallback-text: #fee2e2;

  /* Action Block - Gray (Dark) */
  --event-action-bg: #1f2937;
  --event-action-border: #4b5563;
  --event-action-icon: #9ca3af;
  --event-action-text: #e5e7eb;

  /* Connector (Dark) */
  --event-connector-color: #6b7280;
}

/* ============================================================================
   패널 기본 구조
   ============================================================================ */

.events-panel {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.events-panel .panel-contents {
  flex: 1;
  overflow-y: auto;
}

/* ============================================================================
   핸들러 목록
   ============================================================================ */

.handlers-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.handler-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--color-surface-100);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all 0.15s ease;
}

.handler-item:hover {
  background: var(--color-surface-200);
  border-color: var(--color-primary-300);
}

.handler-item:focus-visible {
  outline: 2px solid var(--color-primary-500);
  outline-offset: 2px;
}

.handler-info {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: var(--spacing-sm);
}

.handler-type {
  font-weight: 500;
  font-size: var(--text-sm);
  color: var(--color-text-primary);
}

.handler-action-count {
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
}

/* ============================================================================
   블록 기본 스타일
   ============================================================================ */

.event-block {
  position: relative;
  background: var(--event-action-bg);
  border: 1px solid var(--event-action-border);
  border-radius: var(--event-block-radius);
  padding: var(--event-block-padding);
  margin-bottom: var(--spacing-md);
}

.event-block .block-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-sm);
}

.event-block .block-label {
  font-weight: 600;
  font-size: var(--text-xs);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.event-block .block-sublabel {
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
  font-weight: 400;
}

.event-block .block-icon {
  flex-shrink: 0;
}

.event-block .block-actions {
  margin-left: auto;
  display: flex;
  gap: var(--spacing-xs);
}

.event-block .block-content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

/* ============================================================================
   WHEN Block (Trigger)
   ============================================================================ */

.when-block {
  background: var(--event-trigger-bg);
  border-color: var(--event-trigger-border);
}

.when-block .block-icon,
.when-block .block-label {
  color: var(--event-trigger-icon);
}

.when-block .trigger-row {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.when-block .trigger-target {
  font-size: var(--text-sm);
  color: var(--event-trigger-text);
}

/* ============================================================================
   IF Block (Condition)
   ============================================================================ */

.if-block {
  background: var(--event-condition-bg);
  border-color: var(--event-condition-border);
}

.if-block .block-icon,
.if-block .block-label {
  color: var(--event-condition-icon);
}

.add-condition-button {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-sm) var(--spacing-md);
  background: transparent;
  border: 1px dashed var(--event-condition-border);
  border-radius: var(--event-block-radius);
  color: var(--event-condition-icon);
  font-size: var(--text-sm);
  cursor: pointer;
  transition: all 0.15s ease;
}

.add-condition-button:hover {
  background: var(--event-condition-bg);
  border-style: solid;
}

/* Condition Row */
.condition-row {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  background: var(--color-white);
  border: 1px solid var(--event-condition-border);
  border-radius: var(--radius-sm);
}

/* Operator Toggle (AND/OR) */
.operator-toggle {
  display: flex;
  justify-content: center;
  padding: var(--spacing-xs) 0;
}

.operator-toggle .toggle-button {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: var(--text-xs);
  font-weight: 600;
  border-radius: var(--radius-sm);
  background: var(--event-condition-border);
  color: var(--color-white);
}

/* ============================================================================
   THEN Block (Success)
   ============================================================================ */

.then-block {
  background: var(--event-success-bg);
  border-color: var(--event-success-border);
}

.then-block .block-icon,
.then-block .block-label {
  color: var(--event-success-icon);
}

/* ============================================================================
   ELSE Block (Fallback)
   ============================================================================ */

.else-block {
  background: var(--event-fallback-bg);
  border-color: var(--event-fallback-border);
}

.else-block .block-icon,
.else-block .block-label {
  color: var(--event-fallback-icon);
}

.add-else-button {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-sm) var(--spacing-md);
  background: transparent;
  border: 1px dashed var(--event-fallback-border);
  border-radius: var(--event-block-radius);
  color: var(--event-fallback-icon);
  font-size: var(--text-sm);
  cursor: pointer;
  transition: all 0.15s ease;
}

.add-else-button:hover {
  background: var(--event-fallback-bg);
  border-style: solid;
}

/* ============================================================================
   Block Connector (연결선)
   ============================================================================ */

.block-connector {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
}

.block-connector.down {
  bottom: -20px;
  height: 20px;
  width: var(--event-connector-width);
  background: var(--event-connector-color);
}

.block-connector.split {
  bottom: -20px;
  width: 100px;
  height: 20px;
  border-left: var(--event-connector-width) solid var(--event-connector-color);
  border-right: var(--event-connector-width) solid var(--event-connector-color);
  border-bottom: var(--event-connector-width) solid var(--event-connector-color);
  background: transparent;
}

/* ============================================================================
   THEN/ELSE 컨테이너
   ============================================================================ */

.then-else-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
  margin-top: 20px;
}

.then-else-container.single {
  grid-template-columns: 1fr;
}

/* ============================================================================
   액션 리스트
   ============================================================================ */

.action-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

.action-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: grab;
}

.action-item:active {
  cursor: grabbing;
}

.action-item .action-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  background: var(--color-surface-200);
  border-radius: 50%;
  font-size: var(--text-xs);
  font-weight: 600;
  color: var(--color-text-secondary);
}

.action-item .action-icon {
  color: var(--event-action-icon);
}

.action-item .action-type {
  font-size: var(--text-xs);
}

.action-item .action-summary {
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Add Action 버튼 */
.add-action-button {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-sm);
  background: transparent;
  border: 1px dashed var(--color-border);
  border-radius: var(--radius-sm);
  color: var(--color-text-tertiary);
  font-size: var(--text-sm);
  cursor: pointer;
  transition: all 0.15s ease;
  width: 100%;
  justify-content: center;
}

.add-action-button:hover {
  background: var(--color-surface-100);
  border-color: var(--color-primary-300);
  color: var(--color-primary-600);
}

/* ============================================================================
   Action Picker 컨테이너
   ============================================================================ */

.action-picker-container {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
}

/* ============================================================================
   포커스 및 접근성
   ============================================================================ */

.event-block:focus-within {
  box-shadow: 0 0 0 2px var(--color-primary-200);
}

.handler-item:focus-visible,
.action-item:focus-visible,
.add-action-button:focus-visible,
.add-condition-button:focus-visible,
.add-else-button:focus-visible {
  outline: 2px solid var(--color-primary-500);
  outline-offset: 2px;
}

/* ============================================================================
   Actions Header (기존 호환)
   ============================================================================ */

.actions-header {
  display: flex;
  align-items: center;
  margin-bottom: var(--spacing-sm);
}

.actions-header .iconButton {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.actions-header .button-label {
  font-size: var(--text-sm);
}

/* ============================================================================
   Condition Row 스타일
   ============================================================================ */

.condition-row {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  background: var(--color-white);
  border: 1px solid var(--event-condition-border);
  border-radius: var(--radius-sm);
}

[data-theme="dark"] .condition-row {
  background: var(--color-surface-100);
}

.condition-drag-handle {
  cursor: grab;
  opacity: 0.5;
  transition: opacity 0.15s ease;
}

.condition-row:hover .condition-drag-handle {
  opacity: 1;
}

.condition-operand {
  flex: 1;
  min-width: 80px;
}

.condition-operand input {
  width: 100%;
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: var(--text-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background: var(--color-white);
}

[data-theme="dark"] .condition-operand input {
  background: var(--color-surface-200);
  border-color: var(--color-border);
  color: var(--color-text-primary);
}

.condition-operand input:focus {
  outline: none;
  border-color: var(--color-primary-500);
  box-shadow: 0 0 0 2px var(--color-primary-100);
}

.condition-remove {
  opacity: 0.5;
  transition: opacity 0.15s ease;
}

.condition-row:hover .condition-remove {
  opacity: 1;
}

/* Add Row Button */
.add-row-button {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  width: 100%;
  padding: var(--spacing-sm);
  background: transparent;
  border: 1px dashed var(--color-border);
  border-radius: var(--radius-sm);
  color: var(--color-text-tertiary);
  font-size: var(--text-sm);
  cursor: pointer;
  transition: all 0.15s ease;
}

.add-row-button:hover {
  background: var(--color-surface-100);
  border-color: var(--color-primary-300);
  color: var(--color-primary-600);
}

/* ============================================================================
   Operator Picker 스타일
   ============================================================================ */

.operator-picker {
  min-width: 100px;
}

.operator-picker-button {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: var(--color-surface-100);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-size: var(--text-sm);
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
}

.operator-picker-button:hover {
  background: var(--color-surface-200);
}

.operator-picker-button:focus {
  outline: none;
  border-color: var(--color-primary-500);
  box-shadow: 0 0 0 2px var(--color-primary-100);
}

.operator-picker-popover {
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  max-height: 300px;
  overflow-y: auto;
}

[data-theme="dark"] .operator-picker-popover {
  background: var(--color-surface-100);
}

.operator-picker-list {
  padding: var(--spacing-xs);
}

.operator-group {
  margin-bottom: var(--spacing-sm);
}

.operator-group:last-child {
  margin-bottom: 0;
}

.operator-group-label {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: var(--text-xs);
  font-weight: 600;
  color: var(--color-text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.operator-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.15s ease;
}

.operator-item:hover,
.operator-item[data-focused] {
  background: var(--color-surface-100);
}

.operator-item[data-selected] {
  background: var(--color-primary-100);
}

.operator-symbol {
  font-family: monospace;
  font-weight: 500;
  min-width: 80px;
}

.operator-description {
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
}

/* ============================================================================
   Element Picker 스타일
   ============================================================================ */

.element-picker {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.element-picker-label {
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--color-text-secondary);
}

.element-picker-input-wrapper {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
}

[data-theme="dark"] .element-picker-input-wrapper {
  background: var(--color-surface-200);
}

.element-picker-input-wrapper:focus-within {
  border-color: var(--color-primary-500);
  box-shadow: 0 0 0 2px var(--color-primary-100);
}

.element-picker-icon {
  color: var(--color-text-tertiary);
  flex-shrink: 0;
}

.element-picker-input {
  flex: 1;
  border: none;
  background: transparent;
  font-size: var(--text-sm);
  outline: none;
}

.element-picker-input::placeholder {
  color: var(--color-text-tertiary);
}

.element-picker-button {
  padding: 2px;
  background: transparent;
  border: none;
  cursor: pointer;
  color: var(--color-text-tertiary);
}

.element-picker-button:hover {
  color: var(--color-text-primary);
}

.element-picker-popover {
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  max-height: 250px;
  overflow-y: auto;
  min-width: 200px;
}

[data-theme="dark"] .element-picker-popover {
  background: var(--color-surface-100);
}

.element-picker-list {
  padding: var(--spacing-xs);
}

.element-picker-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-lg);
  color: var(--color-text-tertiary);
  font-size: var(--text-sm);
}

.element-picker-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.15s ease;
}

.element-picker-item:hover,
.element-picker-item[data-focused] {
  background: var(--color-surface-100);
}

.element-picker-item[data-selected] {
  background: var(--color-primary-100);
}

.element-tag {
  padding: 2px 6px;
  background: var(--color-surface-200);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--color-text-secondary);
}

.element-name {
  font-size: var(--text-sm);
  color: var(--color-text-primary);
}

/* ==================================
   ThenElseBlock Styles
   ================================== */

.branch-block {
  position: relative;
  /* margin-left: var(--spacing-lg); */
}

.branch-block .block-container {
  background: var(--color-white);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
}

[data-theme="dark"] .branch-block .block-container {
  background: var(--color-surface-100);
}

/* THEN Block Colors */
/*.then-block .block-container {
  border-left: 3px solid var(--event-success-color);
}*/

.then-block .block-header {
  background: var(--event-success-bg);
}

.then-block .block-label {
  color: var(--event-success-color);
}

/* ELSE Block Colors */
.else-block .block-container {
  border-left: 3px solid var(--event-fallback-color);
}

.else-block .block-header {
  background: var(--event-fallback-bg);
}

.else-block .block-label {
  color: var(--event-fallback-color);
}

.branch-block .block-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
}

.branch-block .block-collapse-btn {
  padding: 2px;
}

.branch-block .block-label {
  font-size: var(--text-xs);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.branch-block .block-count {
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
}

.branch-block .block-header-spacer {
  flex: 1;
}

.branch-block .block-content {
  padding: var(--spacing-sm);
}

.branch-block .block-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  color: var(--color-text-tertiary);
  font-size: var(--text-sm);
}

.branch-block .add-action-btn {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: transparent;
  border: 1px dashed var(--color-border);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.branch-block .add-action-btn:hover {
  background: var(--color-surface-50);
  border-color: var(--color-primary-300);
  color: var(--color-primary-600);
}

/* ==================================
   ActionTypePicker Styles
   ================================== */

.action-type-picker,
.action-type-picker-inline {
  position: relative;
}

.action-picker-input-wrapper {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
}

[data-theme="dark"] .action-picker-input-wrapper {
  background: var(--color-surface-200);
}

.action-picker-input-wrapper:focus-within {
  border-color: var(--color-primary-500);
  box-shadow: 0 0 0 2px var(--color-primary-100);
}

.action-picker-input {
  flex: 1;
  border: none;
  background: transparent;
  font-size: var(--text-sm);
  outline: none;
}

.action-picker-input::placeholder {
  color: var(--color-text-tertiary);
}

.action-picker-button {
  padding: 2px;
  background: transparent;
  border: none;
  cursor: pointer;
  color: var(--color-text-tertiary);
}

.action-picker-button:hover {
  color: var(--color-text-primary);
}

.action-picker-popover {
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  max-height: 320px;
  overflow-y: auto;
  min-width: 260px;
}

[data-theme="dark"] .action-picker-popover {
  background: var(--color-surface-100);
}

.action-picker-search {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
}

.action-picker-search-input {
  flex: 1;
  border: none;
  background: transparent;
  font-size: var(--text-sm);
  outline: none;
}

.action-picker-search-input::placeholder {
  color: var(--color-text-tertiary);
}

.action-picker-list {
  padding: 0;
}

.action-picker-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-lg);
  color: var(--color-text-tertiary);
  font-size: var(--text-sm);
}

.action-group {
  margin-bottom: var(--spacing-sm);
}

.action-group:last-child {
  margin-bottom: 0;
}

.action-group-label {
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: var(--text-xs);
  font-weight: 600;
  color: var(--color-text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.action-picker-list .action-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.15s ease;
}

.action-picker-list .action-item:hover,
.action-picker-list .action-item[data-focused] {
  background: var(--color-surface-100);
}

.action-picker-list .action-item[data-selected] {
  background: var(--color-primary-100);
}

.action-picker-list .action-name {
  font-size: var(--text-xs);
  color: var(--color-text-primary);
}

.action-picker-list .action-type-code {
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
  font-family: var(--font-mono);
}

/* ==================================
   ActionList Styles
   ================================== */

.action-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.action-list-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  color: var(--color-text-tertiary);
  font-size: var(--text-sm);
}

.action-list-item {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-xs);
}

.action-reorder-buttons {
  display: flex;
  flex-direction: column;
  gap: 1px;
}

.action-reorder-btn {
  padding: 2px;
  opacity: 0.5;
  transition: opacity 0.15s ease;
}

.action-list-item:hover .action-reorder-btn {
  opacity: 1;
}

.action-reorder-btn:disabled {
  opacity: 0.2;
}

.action-list-item-content {
  flex: 1;
  min-width: 0;
}

.action-list-add {
  display: flex;
  justify-content: center;
  padding: var(--spacing-xs) 0;
}

/* ==================================
   BlockActionEditor Styles
   ================================== */

.block-action-editor {
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  overflow: hidden;
}

[data-theme="dark"] .block-action-editor {
  background: var(--color-surface-100);
}

.block-action-editor-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
  background: var(--color-surface-50);
}

[data-theme="dark"] .block-action-editor-header {
  background: var(--color-surface-200);
}

.block-action-editor-title {
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--color-text-primary);
}

.block-action-enabled-toggle {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.block-action-enabled-toggle .switch-label {
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
}

.block-action-editor-spacer {
  flex: 1;
}

.block-action-type-row {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
}

.block-action-type-label {
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--color-text-secondary);
  min-width: 40px;
}

.block-action-config {
  padding: var(--spacing-sm);
}

/* Hide the type selector from nested ActionEditor since we have our own */
.block-action-config .action-type-selector {
  display: none;
}

.block-action-advanced-toggle {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  width: 100%;
  padding: var(--spacing-xs) var(--spacing-sm);
  background: transparent;
  border: none;
  border-top: 1px solid var(--color-border);
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: background 0.15s ease;
}

.block-action-advanced-toggle:hover {
  background: var(--color-surface-50);
}

.block-action-advanced {
  padding: var(--spacing-sm);
  border-top: 1px solid var(--color-border);
  background: var(--color-surface-50);
}

[data-theme="dark"] .block-action-advanced {
  background: var(--color-surface-200);
}

/* ==================================
   VariableBindingEditor Styles
   ================================== */

.variable-binding-editor {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.variable-input-wrapper {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  transition: border-color 0.15s ease, box-shadow 0.15s ease;
}

[data-theme="dark"] .variable-input-wrapper {
  background: var(--color-surface-200);
}

.variable-input-wrapper:focus-within {
  border-color: var(--color-primary-500);
  box-shadow: 0 0 0 2px var(--color-primary-100);
}

.variable-icon {
  flex-shrink: 0;
  color: var(--color-text-tertiary);
  transition: color 0.15s ease;
}

.variable-icon.has-bindings {
  color: var(--color-primary-500);
}

.variable-input {
  flex: 1;
  border: none;
  background: transparent;
  font-size: var(--text-sm);
  font-family: var(--font-mono);
  outline: none;
}

.variable-input::placeholder {
  color: var(--color-text-tertiary);
  font-family: var(--font-sans);
}

.variable-input.has-errors {
  color: var(--color-red-600);
}

.variable-status-icon {
  flex-shrink: 0;
}

.variable-status-icon.error {
  color: var(--color-red-500);
}

.variable-status-icon.valid {
  color: var(--color-green-500);
}

/* Variable Suggestions Popover */
.variable-suggestions-popover {
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  max-height: 200px;
  overflow-y: auto;
  min-width: 200px;
}

[data-theme="dark"] .variable-suggestions-popover {
  background: var(--color-surface-100);
}

.variable-suggestions-list {
  padding: var(--spacing-xs);
}

.variable-suggestion-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.15s ease;
}

.variable-suggestion-item:hover,
.variable-suggestion-item[data-focused] {
  background: var(--color-surface-100);
}

.suggestion-label {
  font-size: var(--text-sm);
  font-weight: 500;
  color: var(--color-text-primary);
  font-family: var(--font-mono);
}

.suggestion-description {
  flex: 1;
  font-size: var(--text-xs);
  color: var(--color-text-tertiary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.suggestion-arrow {
  flex-shrink: 0;
  color: var(--color-text-tertiary);
}

/* Variable Errors */
.variable-errors {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.variable-error {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-size: var(--text-xs);
  color: var(--color-red-600);
}

/* Variable Bindings Preview */
.variable-bindings-preview {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-xs);
}

.binding-tag {
  display: inline-flex;
  align-items: center;
  padding: 2px 6px;
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-family: var(--font-mono);
}

.binding-tag.binding-state {
  background: var(--color-blue-100);
  color: var(--color-blue-700);
}

.binding-tag.binding-event {
  background: var(--color-purple-100);
  color: var(--color-purple-700);
}

.binding-tag.binding-datatable {
  background: var(--color-green-100);
  color: var(--color-green-700);
}

.binding-tag.binding-response {
  background: var(--color-orange-100);
  color: var(--color-orange-700);
}

.binding-tag.binding-element {
  background: var(--color-cyan-100);
  color: var(--color-cyan-700);
}

.binding-tag.binding-variable {
  background: var(--color-pink-100);
  color: var(--color-pink-700);
}

.binding-tag.binding-unknown {
  background: var(--color-gray-100);
  color: var(--color-gray-700);
}

[data-theme="dark"] .binding-tag.binding-state {
  background: var(--color-blue-900);
  color: var(--color-blue-300);
}

[data-theme="dark"] .binding-tag.binding-event {
  background: var(--color-purple-900);
  color: var(--color-purple-300);
}

[data-theme="dark"] .binding-tag.binding-datatable {
  background: var(--color-green-900);
  color: var(--color-green-300);
}

[data-theme="dark"] .binding-tag.binding-response {
  background: var(--color-orange-900);
  color: var(--color-orange-300);
}

[data-theme="dark"] .binding-tag.binding-element {
  background: var(--color-cyan-900);
  color: var(--color-cyan-300);
}

[data-theme="dark"] .binding-tag.binding-variable {
  background: var(--color-pink-900);
  color: var(--color-pink-300);
}

[data-theme="dark"] .binding-tag.binding-unknown {
  background: var(--color-gray-800);
  color: var(--color-gray-300);
}

/* ==========================================================================
   Phase 5: Preview Components
   ========================================================================== */

/* Code Preview Panel */
.code-preview-panel {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-surface);
  overflow: hidden;
}

.code-preview-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--color-gray-50);
  border-bottom: 1px solid var(--color-border);
}

[data-theme="dark"] .code-preview-header {
  background: var(--color-gray-800);
}

.code-preview-toggle {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: 0;
  background: none;
  border: none;
  cursor: pointer;
  font-size: var(--text-sm);
  font-weight: 500;
  color: var(--color-text);
}

.code-preview-toggle:hover {
  color: var(--color-primary-600);
}

.code-preview-content {
  max-height: 300px;
  overflow: auto;
}

.code-preview-code {
  margin: 0;
  padding: var(--spacing-md);
  font-family: "SF Mono", "Fira Code", monospace;
  font-size: var(--text-xs);
  line-height: 1.6;
  white-space: pre;
  color: var(--color-text);
  background: var(--color-gray-50);
}

[data-theme="dark"] .code-preview-code {
  background: var(--color-gray-900);
}

/* Event Minimap */
.event-minimap {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-surface);
  overflow: hidden;
}

.event-minimap-empty {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100px;
  color: var(--color-text-muted);
  font-size: var(--text-sm);
}

.event-minimap-svg {
  display: block;
  width: 100%;
  height: auto;
}

.minimap-block {
  transition: opacity 150ms ease;
}

.minimap-block:hover {
  opacity: 0.8;
}

.minimap-block.selected rect {
  filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.2));
}

/* Event Debugger */
.event-debugger {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-surface);
}

.debugger-controls {
  display: flex;
  gap: var(--spacing-sm);
}

.debugger-btn {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  font-size: var(--text-sm);
  font-weight: 500;
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
  background: var(--color-surface);
  color: var(--color-text);
  cursor: pointer;
  transition: all 150ms ease;
}

.debugger-btn:hover:not([disabled]) {
  border-color: var(--color-primary-500);
  color: var(--color-primary-600);
}

.debugger-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.debugger-btn.primary {
  background: var(--color-primary-600);
  border-color: var(--color-primary-600);
  color: white;
}

.debugger-btn.primary:hover:not([disabled]) {
  background: var(--color-primary-700);
  border-color: var(--color-primary-700);
}

/* Mock Event Input */
.debugger-mock-event {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.mock-event-input {
  width: 100%;
  padding: var(--spacing-sm);
  font-family: "SF Mono", "Fira Code", monospace;
  font-size: var(--text-xs);
  line-height: 1.5;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background: var(--color-gray-50);
  color: var(--color-text);
  resize: vertical;
}

[data-theme="dark"] .mock-event-input {
  background: var(--color-gray-800);
}

.mock-event-input:focus {
  outline: none;
  border-color: var(--color-primary-500);
  box-shadow: 0 0 0 2px var(--color-primary-100);
}

[data-theme="dark"] .mock-event-input:focus {
  box-shadow: 0 0 0 2px var(--color-primary-900);
}

/* Execution Steps */
.debugger-steps {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.debugger-section-title {
  font-size: var(--text-xs);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-muted);
  margin-bottom: var(--spacing-xs);
}

.debugger-step {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background: var(--color-surface);
  overflow: hidden;
}

.debugger-step.current {
  border-color: var(--color-primary-500);
  box-shadow: 0 0 0 2px var(--color-primary-100);
}

[data-theme="dark"] .debugger-step.current {
  box-shadow: 0 0 0 2px var(--color-primary-900);
}

.debugger-step.success {
  border-color: var(--color-green-300);
  background: var(--color-green-50);
}

[data-theme="dark"] .debugger-step.success {
  border-color: var(--color-green-700);
  background: var(--color-green-950);
}

.debugger-step.failed {
  border-color: var(--color-red-300);
  background: var(--color-red-50);
}

[data-theme="dark"] .debugger-step.failed {
  border-color: var(--color-red-700);
  background: var(--color-red-950);
}

.debugger-step.skipped {
  opacity: 0.5;
}

.step-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  width: 100%;
  padding: var(--spacing-sm);
  background: none;
  border: none;
  cursor: pointer;
  font-size: var(--text-sm);
  color: var(--color-text);
  text-align: left;
}

.step-header:hover {
  background: var(--color-gray-50);
}

[data-theme="dark"] .step-header:hover {
  background: var(--color-gray-800);
}

.step-icon {
  flex-shrink: 0;
}

.step-icon.success {
  color: var(--color-green-600);
}

.step-icon.failed {
  color: var(--color-red-600);
}

.step-icon.running {
  color: var(--color-primary-600);
  animation: spin 1s linear infinite;
}

.step-icon.skipped {
  color: var(--color-gray-400);
}

.step-icon.pending {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  border: 2px solid var(--color-gray-300);
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.step-name {
  flex: 1;
  font-weight: 500;
}

.step-duration {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
}

/* Step Details */
.step-details {
  padding: var(--spacing-sm);
  border-top: 1px solid var(--color-border);
  background: var(--color-gray-50);
}

[data-theme="dark"] .step-details {
  background: var(--color-gray-800);
}

.step-io {
  margin-bottom: var(--spacing-sm);
}

.step-io:last-child {
  margin-bottom: 0;
}

.io-label {
  display: block;
  font-size: var(--text-xs);
  font-weight: 600;
  color: var(--color-text-muted);
  margin-bottom: var(--spacing-xs);
}

.io-value {
  margin: 0;
  padding: var(--spacing-xs);
  font-family: "SF Mono", "Fira Code", monospace;
  font-size: 10px;
  line-height: 1.4;
  background: var(--color-surface);
  border-radius: var(--radius-sm);
  overflow-x: auto;
  max-height: 100px;
}

.step-error {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  background: var(--color-red-50);
  border-radius: var(--radius-sm);
  color: var(--color-red-700);
  font-size: var(--text-xs);
}

[data-theme="dark"] .step-error {
  background: var(--color-red-900);
  color: var(--color-red-300);
}

/* Execution Logs */
.debugger-logs {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
  max-height: 200px;
  overflow-y: auto;
}

.debugger-log {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
}

.debugger-log.success {
  background: var(--color-green-50);
  color: var(--color-green-700);
}

[data-theme="dark"] .debugger-log.success {
  background: var(--color-green-950);
  color: var(--color-green-300);
}

.debugger-log.error {
  background: var(--color-red-50);
  color: var(--color-red-700);
}

[data-theme="dark"] .debugger-log.error {
  background: var(--color-red-950);
  color: var(--color-red-300);
}

.debugger-log.warning {
  background: var(--color-amber-50);
  color: var(--color-amber-700);
}

[data-theme="dark"] .debugger-log.warning {
  background: var(--color-amber-950);
  color: var(--color-amber-300);
}

.log-time {
  flex-shrink: 0;
  font-family: "SF Mono", "Fira Code", monospace;
  color: var(--color-text-muted);
}

.log-message {
  flex: 1;
}

.log-duration {
  flex-shrink: 0;
  font-family: "SF Mono", "Fira Code", monospace;
}

/* ==========================================================================
   Block View (Integrated Block-based UI)
   ========================================================================== */

.section.block-view {
  display: flex;
  flex-direction: column;
}

.block-editor {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  padding: var(--spacing-sm);
  background: var(--color-surface-50);
  border-radius: var(--radius-md);
  position: relative;
}

[data-theme="dark"] .block-editor {
  background: var(--color-surface-200);
}

/* Action Picker Overlay */
.action-picker-overlay {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-md);
}

[data-theme="dark"] .action-picker-overlay {
  background: var(--color-surface-100);
}

/* Action Editor Overlay */
.action-editor-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--color-white);
  border-radius: var(--radius-md);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  z-index: 10;
}

[data-theme="dark"] .action-editor-overlay {
  background: var(--color-surface-100);
}

.action-editor-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--color-surface-50);
  border-bottom: 1px solid var(--color-border);
}

[data-theme="dark"] .action-editor-header {
  background: var(--color-surface-200);
}

.action-editor-title {
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--color-text-primary);
}

.action-editor-overlay .block-action-editor {
  flex: 1;
  overflow-y: auto;
  border: none;
  border-radius: 0;
}

/* ==========================================================================
   Picker Inline Trigger Styles
   ========================================================================== */

.event-picker-inline-trigger,
.action-picker-inline-trigger {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--spacing-sm);
  padding: var(--spacing-xs) var(--spacing-sm);
  min-width: 140px;
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-size: var(--text-sm);
  color: var(--color-text-primary);
  cursor: pointer;
  transition: all 0.15s ease;
}

[data-theme="dark"] .event-picker-inline-trigger,
[data-theme="dark"] .action-picker-inline-trigger {
  background: var(--color-surface-200);
}

.event-picker-inline-trigger:hover,
.action-picker-inline-trigger:hover {
  border-color: var(--color-primary-400);
}

.event-picker-inline-trigger:focus,
.action-picker-inline-trigger:focus {
  outline: none;
  border-color: var(--color-primary-500);
  box-shadow: 0 0 0 2px var(--color-primary-100);
}

.event-picker-value,
.action-picker-value {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Group label items (non-selectable) */
.event-group-label-item,
.action-group-label-item {
  cursor: default;
  pointer-events: none;
}

.event-group-label-item[data-focused],
.action-group-label-item[data-focused] {
  background: transparent;
}
