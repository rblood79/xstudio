import{D as $,r as n,j as e,aN as _,aO as z,aP as D,aQ as H,l as k,i as j,aR as q,a8 as M,aS as O,u as C,B,q as E,a9 as I,P as N,a as F,b as A,c as G,H as Y}from"./index-D5lAmiE8.js";import{P as T}from"./labels-C7QIhqP9.js";import{LayoutSlugEditor as W}from"./LayoutSlugEditor-BqnSBXEH.js";const J=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],Q=$("columns-2",J);const X=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],V=$("layout-dashboard",X);const Z=[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]],U=$("merge",Z),K=n.memo(function({areas:l,width:h=120,height:o=80,selectedSlot:s}){const m=n.useMemo(()=>l.map(t=>{const g=s===t.name,c=t.required;let r;return g?r="var(--color-primary-200)":c?r="var(--color-primary-100)":t.isSlot?r="var(--color-gray-100)":r="var(--color-gray-50)",e.jsxs("g",{children:[e.jsx("rect",{x:`${t.x}%`,y:`${t.y}%`,width:`${t.width}%`,height:`${t.height}%`,fill:r,stroke:g?"var(--color-primary-500)":"var(--color-gray-300)",strokeWidth:g?2:1,rx:2}),t.width>=20&&t.height>=15&&e.jsx("text",{x:`${t.x+t.width/2}%`,y:`${t.y+t.height/2}%`,textAnchor:"middle",dominantBaseline:"middle",fill:"var(--color-gray-600)",fontSize:"8",fontFamily:"var(--font-sans)",children:t.name}),c&&t.width>=15&&e.jsx("text",{x:`${t.x+t.width-2}%`,y:`${t.y+4}%`,textAnchor:"end",fill:"var(--color-primary-600)",fontSize:"8",fontWeight:"bold",children:"*"})]},t.name)}),[l,s]);return e.jsx("svg",{width:h,height:o,viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"preset-preview-svg",style:{border:"1px solid var(--color-gray-200)",borderRadius:"var(--radius-sm)",backgroundColor:"var(--color-white)"},children:m})}),ee=n.memo(function({isOpen:l,existingSlots:h,presetName:o,onConfirm:s,onClose:m}){const t=h.some(f=>f.hasChildren),g=n.useCallback(()=>{s("replace")},[s]),c=n.useCallback(()=>{s("merge")},[s]),r=n.useCallback(()=>{s("cancel"),m()},[s,m]);return l?e.jsx(_,{isOpen:l,children:e.jsx(z,{isDismissable:!0,onOpenChange:f=>!f&&m(),className:"react-aria-Modal",children:e.jsxs(D,{className:"react-aria-Dialog existing-slot-dialog",children:[e.jsxs(H,{slot:"title",className:"dialog-title",children:[e.jsx(k,{className:"icon-warning",size:j.size}),"기존 Slot이 있습니다"]}),e.jsxs("div",{className:"dialog-content",children:[e.jsxs("p",{className:"dialog-description",children:["“",o,"” 프리셋을 적용하려면 기존 Slot을 어떻게 처리할지 선택하세요."]}),e.jsxs("div",{className:"existing-slots-list",children:[e.jsxs("p",{className:"list-title",children:["현재 Slot (",h.length,"개):"]}),e.jsx("ul",{children:h.map(f=>e.jsxs("li",{children:[e.jsx("span",{className:"slot-name",children:f.slotName}),f.hasChildren&&e.jsx("span",{className:"slot-warning",children:"(콘텐츠 있음)"})]},f.elementId))})]}),t&&e.jsxs("div",{className:"warning-box",children:[e.jsx(k,{size:j.size}),e.jsx("span",{children:"일부 Slot에 콘텐츠가 있습니다. 덮어쓰기 시 삭제됩니다."})]})]}),e.jsxs("div",{className:"dialog-actions",children:[e.jsxs(q,{variant:"default",onPress:r,children:[e.jsx(M,{size:j.size}),"취소"]}),e.jsxs(q,{variant:"secondary",onPress:c,children:[e.jsx(U,{size:j.size}),"병합 (새 Slot만 추가)"]}),e.jsxs(q,{variant:"primary",onPress:g,children:[e.jsx(O,{size:j.size}),"덮어쓰기"]})]})]})})}):null}),v={fullscreen:{id:"fullscreen",name:"전체화면",description:"단일 전체 화면 콘텐츠",category:"basic",slots:[{name:"content",required:!0,description:"전체 화면 콘텐츠"}],containerStyle:{display:"flex",minHeight:"100vh"},previewAreas:[{name:"content",x:0,y:0,width:100,height:100,isSlot:!0,required:!0}]},"vertical-2":{id:"vertical-2",name:"수직 2단",description:"Header + Content",category:"basic",slots:[{name:"header",required:!1,description:"상단 헤더 영역"},{name:"content",required:!0,description:"메인 콘텐츠 영역"}],containerStyle:{display:"flex",flexDirection:"column",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:15,isSlot:!0},{name:"content",x:0,y:15,width:100,height:85,isSlot:!0,required:!0}]},"vertical-3":{id:"vertical-3",name:"수직 3단",description:"Header + Content + Footer",category:"basic",slots:[{name:"header",required:!1,description:"상단 헤더 영역"},{name:"content",required:!0,description:"메인 콘텐츠 영역"},{name:"footer",required:!1,description:"하단 푸터 영역"}],containerStyle:{display:"flex",flexDirection:"column",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:12,isSlot:!0},{name:"content",x:0,y:12,width:100,height:76,isSlot:!0,required:!0},{name:"footer",x:0,y:88,width:100,height:12,isSlot:!0}]},"sidebar-left":{id:"sidebar-left",name:"좌측 사이드바",description:"Sidebar + Content",category:"sidebar",slots:[{name:"sidebar",required:!1,description:"좌측 사이드바",defaultStyle:{width:"250px"}},{name:"content",required:!0,description:"메인 콘텐츠"}],containerStyle:{display:"flex",flexDirection:"row",minHeight:"100vh"},previewAreas:[{name:"sidebar",x:0,y:0,width:25,height:100,isSlot:!0},{name:"content",x:25,y:0,width:75,height:100,isSlot:!0,required:!0}]},"sidebar-right":{id:"sidebar-right",name:"우측 사이드바",description:"Content + Sidebar",category:"sidebar",slots:[{name:"content",required:!0,description:"메인 콘텐츠"},{name:"sidebar",required:!1,description:"우측 사이드바",defaultStyle:{width:"250px"}}],containerStyle:{display:"flex",flexDirection:"row",minHeight:"100vh"},previewAreas:[{name:"content",x:0,y:0,width:75,height:100,isSlot:!0,required:!0},{name:"sidebar",x:75,y:0,width:25,height:100,isSlot:!0}]},"holy-grail":{id:"holy-grail",name:"Holy Grail",description:"Header + (Sidebar + Content + Aside) + Footer",category:"complex",slots:[{name:"header",required:!1},{name:"sidebar",required:!1,defaultStyle:{width:"200px"}},{name:"content",required:!0},{name:"aside",required:!1,defaultStyle:{width:"200px"}},{name:"footer",required:!1}],containerStyle:{display:"grid",gridTemplateAreas:`
        "header header header"
        "sidebar content aside"
        "footer footer footer"
      `,gridTemplateColumns:"200px 1fr 200px",gridTemplateRows:"auto 1fr auto",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:12,isSlot:!0},{name:"sidebar",x:0,y:12,width:20,height:76,isSlot:!0},{name:"content",x:20,y:12,width:60,height:76,isSlot:!0,required:!0},{name:"aside",x:80,y:12,width:20,height:76,isSlot:!0},{name:"footer",x:0,y:88,width:100,height:12,isSlot:!0}]},"complex-3col":{id:"complex-3col",name:"3열 레이아웃",description:"Header + 3 Columns + Footer",category:"complex",slots:[{name:"header",required:!1},{name:"left",required:!1},{name:"content",required:!0},{name:"right",required:!1},{name:"footer",required:!1}],containerStyle:{display:"grid",gridTemplateAreas:`
        "header header header"
        "left content right"
        "footer footer footer"
      `,gridTemplateColumns:"1fr 2fr 1fr",gridTemplateRows:"auto 1fr auto",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:12,isSlot:!0},{name:"left",x:0,y:12,width:25,height:76,isSlot:!0},{name:"content",x:25,y:12,width:50,height:76,isSlot:!0,required:!0},{name:"right",x:75,y:12,width:25,height:76,isSlot:!0},{name:"footer",x:0,y:88,width:100,height:12,isSlot:!0}]},dashboard:{id:"dashboard",name:"대시보드",description:"Navigation + Sidebar + Main Content",category:"dashboard",slots:[{name:"navigation",required:!1,description:"상단 네비게이션"},{name:"sidebar",required:!1,description:"좌측 메뉴",defaultStyle:{width:"240px"}},{name:"content",required:!0,description:"대시보드 콘텐츠"}],containerStyle:{display:"grid",gridTemplateAreas:`
        "navigation navigation"
        "sidebar content"
      `,gridTemplateColumns:"240px 1fr",gridTemplateRows:"auto 1fr",minHeight:"100vh"},previewAreas:[{name:"navigation",x:0,y:0,width:100,height:10,isSlot:!0},{name:"sidebar",x:0,y:10,width:24,height:90,isSlot:!0},{name:"content",x:24,y:10,width:76,height:90,isSlot:!0,required:!0}]},"dashboard-widgets":{id:"dashboard-widgets",name:"대시보드 (위젯)",description:"Header + Sidebar + Main + Widgets Panel",category:"dashboard",slots:[{name:"header",required:!1},{name:"sidebar",required:!1},{name:"content",required:!0},{name:"widgets",required:!1}],containerStyle:{display:"grid",gridTemplateAreas:`
        "header header header"
        "sidebar content widgets"
      `,gridTemplateColumns:"200px 1fr 280px",gridTemplateRows:"auto 1fr",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:10,isSlot:!0},{name:"sidebar",x:0,y:10,width:20,height:90,isSlot:!0},{name:"content",x:20,y:10,width:52,height:90,isSlot:!0,required:!0},{name:"widgets",x:72,y:10,width:28,height:90,isSlot:!0}]}},te={basic:{label:"기본",icon:"Layout"},sidebar:{label:"사이드바",icon:"Columns2"},complex:{label:"복합",icon:"LayoutGrid"},dashboard:{label:"대시보드",icon:"LayoutDashboard"}},ie=["fullscreen","vertical-2","vertical-3","sidebar-left","sidebar-right","holy-grail","complex-3col","dashboard","dashboard-widgets"];function se({layoutId:p,bodyElementId:l}){const[h,o]=n.useState(!1),s=C(i=>i.elements),m=C(i=>i.addComplexElement),t=C(i=>i.removeElement),g=C(i=>i.updateElementProps),c=n.useMemo(()=>s.filter(i=>i.layout_id===p&&i.tag==="Slot").map(i=>{const y=s.some(u=>u.parent_id===i.id||u.props?.slot_name===i.props?.name);return{slotName:i.props?.name||"unnamed",elementId:i.id,hasChildren:y}}),[s,p]),r=n.useMemo(()=>{const i=s.find(u=>u.id===l);if(!i)return null;const y=i.props?.appliedPreset;if(y&&v[y]){const u=v[y],S=new Set(u.slots.map(x=>x.name)),d=new Set(c.map(x=>x.slotName));if(d.size===S.size&&[...d].every(x=>S.has(x)))return y}return null},[s,l,c]),f=n.useCallback(async(i,y)=>{if(y==="cancel")return;const u=v[i];if(!u){console.error(`[usePresetApply] Unknown preset: ${i}`);return}console.log(`[Preset] Applying "${u.name}" to layout ${p.slice(0,8)}...`),o(!0);try{y==="replace"&&c.length>0&&(console.log(`[Preset] Removing ${c.length} existing slots...`),await Promise.all(c.map(a=>t(a.elementId))),console.log(`[Preset] Removed ${c.length} existing slots`));const S=new Set(c.map(a=>a.slotName)),d=y==="merge"?u.slots.filter(a=>!S.has(a.name)):u.slots;if(d.length===0){console.log("[Preset] No new slots to create (all already exist)"),o(!1);return}console.log(`[Preset] Creating ${d.length} new slots...`);let x=1;const b=d.map(a=>({id:crypto.randomUUID(),tag:"Slot",props:{name:a.name,required:a.required,description:a.description,style:a.defaultStyle},parent_id:l,layout_id:p,page_id:null,order_num:x++})),P=s.find(a=>a.id===l);if(P){const a=P.props?.style||{},w=u.containerStyle?{...a,...u.containerStyle}:a;await g(l,{style:w,appliedPreset:i}),console.log(`[Preset] Saved appliedPreset="${i}" to body`)}if(b.length>0){const[a,...w]=b;await m(a,w),console.log(`[Preset] Created ${b.length} slots with single history entry`)}console.log(`[Preset] "${u.name}" applied successfully`)}catch(S){throw console.error("[Preset] Failed to apply preset:",S),S}finally{o(!1)}},[p,l,c,s,m,t,g]);return{existingSlots:c,currentPresetKey:r,applyPreset:f,isApplying:h}}const re={basic:E,sidebar:Q,complex:B,dashboard:V},ae=n.memo(function({layoutId:l,bodyElementId:h}){const[o,s]=n.useState(null),[m,t]=n.useState(!1),{existingSlots:g,currentPresetKey:c,applyPreset:r,isApplying:f}=se({layoutId:l,bodyElementId:h}),i=n.useMemo(()=>{const d={basic:[],sidebar:[],complex:[],dashboard:[]};return ie.forEach(x=>{const b=v[x];b&&d[b.category].push(x)}),d},[]),y=n.useCallback(d=>{if(c===d){console.log(`[Preset] "${d}" is already applied, skipping`);return}s(d),g.length>0?t(!0):r(d,"replace")},[g.length,c,r]),u=n.useCallback(d=>{o&&d!=="cancel"&&r(o,d),t(!1),s(null)},[o,r]),S=n.useCallback(()=>{t(!1),s(null)},[]);return e.jsxs(e.Fragment,{children:[Object.entries(te).map(([d,x])=>{const b=i[d];if(!b||b.length===0)return null;const P=re[d]||E;return e.jsxs("div",{className:"list-subgroup",children:[e.jsxs("div",{className:"list-subgroup-header",children:[e.jsx(P,{size:I.size,className:"list-subgroup-icon"}),e.jsx("span",{className:"list-subgroup-title",children:x.label})]}),e.jsx("div",{className:"list-group",role:"list",children:b.map(a=>{const w=v[a];if(!w)return null;const R=o===a,L=c===a;return e.jsxs(q,{variant:"default",className:`list-item preset-card ${R?"selected":""} ${L?"applied":""}`,onPress:()=>y(a),isDisabled:f,children:[e.jsx(K,{areas:w.previewAreas,width:80,height:60}),e.jsx("span",{className:"list-item-name",children:w.name}),L&&e.jsx("span",{className:"list-item-badge applied",children:"적용됨"})]},a)})})]},d)}),e.jsx(ee,{isOpen:m,existingSlots:g,presetName:o&&v[o]?.name||"",onConfirm:u,onClose:S})]})}),de=n.memo(function({elementId:l,currentProps:h,onUpdate:o}){const{customId:s,layoutId:m}=n.useMemo(()=>{const r=C.getState().elementsMap.get(l);return{customId:r?.customId||"",layoutId:r?.layout_id||null}},[l]),t=n.useCallback(r=>{o({...h,className:r||void 0})},[h,o]),g=n.useCallback(r=>{o({...h,"aria-label":r||void 0})},[h,o]),c=n.useCallback(r=>{o({...h,"aria-labelledby":r||void 0})},[h,o]);return e.jsxs(e.Fragment,{children:[e.jsx(N,{title:"Basic",children:e.jsx(F,{label:"ID",value:s,elementId:l,placeholder:"layout-body"})}),m&&e.jsx(N,{title:"Layout Preset",children:e.jsx(ae,{layoutId:m,bodyElementId:l})}),m&&e.jsx(W,{layoutId:m}),e.jsx(N,{title:"Layout",children:e.jsx(A,{label:"Class Name",value:String(h.className||""),onChange:t,placeholder:"layout-container",icon:E})}),e.jsxs(N,{title:"Accessibility",children:[e.jsx(A,{label:T.ARIA_LABEL,value:String(h["aria-label"]||""),onChange:g,icon:G,placeholder:"Layout content area"}),e.jsx(A,{label:T.ARIA_LABELLEDBY,value:String(h["aria-labelledby"]||""),onChange:c,icon:Y,placeholder:"ID of labeling element"})]})]})},(p,l)=>p.elementId===l.elementId&&JSON.stringify(p.currentProps)===JSON.stringify(l.currentProps));export{de as LayoutBodyEditor,de as default};
