import{j as e,s as o}from"./index-BvISBzjo.js";import{u as P,r as i}from"./react-vendor-B_C40l-y.js";import"./supabase-B0cjvv2_.js";function _(){const l=P(),[f,a]=i.useState([]),[c,d]=i.useState("");i.useEffect(()=>{(async()=>{const{data:s,error:t}=await o.from("projects").select("*");t?console.error("프로젝트 조회 에러:",t):a(s)})()},[]);const x=async r=>{r.preventDefault();const{data:s,error:t}=await o.auth.getSession();if(t||!(s!=null&&s.session)){console.error("세션 조회 에러:",t);return}const n=s.session.user.id;if(!c.trim()){console.error("프로젝트 이름이 비어 있습니다.");return}const{data:w,error:u}=await o.from("projects").insert([{name:c,created_by:n}]).select();if(u){console.error("프로젝트 추가 에러:",u);return}const m=w[0],j=m.id,{error:h}=await o.from("pages").insert([{project_id:j,title:"Home",slug:"home"}]);h&&console.error("기본 페이지 생성 에러:",h);const{error:p}=await o.from("project_users").insert([{project_id:j,user_id:n,role:"owner"}]);p&&console.error("프로젝트 사용자 추가 에러:",p),a(g=>[...g,m]),d("")},b=async r=>{const{error:s}=await o.from("projects").delete().eq("id",r);s?console.error("프로젝트 삭제 에러:",s):a(t=>t.filter(n=>n.id!==r))},N=async r=>{const s=`/builder/${encodeURIComponent(r.id)}?name=${encodeURIComponent(r.name)}`;l(s)},v=async()=>{await o.auth.signOut(),l("/")};return e.jsx("div",{id:"app",children:e.jsxs("div",{className:"contents",children:[e.jsxs("main",{className:"main",children:[e.jsx("h2",{children:"Projects List"}),e.jsxs("form",{onSubmit:x,children:[e.jsx("input",{type:"text",value:c,onChange:r=>d(r.target.value),placeholder:"프로젝트 이름 입력",required:!0}),e.jsx("button",{type:"submit",children:"프로젝트 추가"})]}),e.jsx("section",{className:"projects",children:f.map(r=>e.jsxs("div",{className:"project-item",children:[e.jsx("div",{children:r.name}),e.jsx("div",{children:r.updated_at}),e.jsx("button",{className:"open-builder",onClick:()=>N(r),children:"빌더 열기"}),e.jsx("button",{className:"close-builder",onClick:()=>b(r.id),children:"삭제"})]},r.id))})]}),e.jsx("aside",{className:"left-sidebar",children:"left-sidebar"}),e.jsxs("nav",{className:"header",children:["header",e.jsx("button",{onClick:v,children:"로그아웃"})]}),e.jsx("footer",{className:"footer",children:"footer"})]})})}export{_ as default};
