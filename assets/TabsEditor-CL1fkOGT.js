import{c as z,r as l,u as S,j as s,P as y,a as F,d as B,at as $,e as _,b as D,T as H,H as j,aw as Y,i as A,h as E,E as v,g as N}from"./index-CjM1KX21.js";import{P as g}from"./labels-C7QIhqP9.js";import{P as G}from"./pointer-off-B4YQNQDp.js";import{R as J}from"./ratio-DDLFXxf8.js";const W=[["path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z",key:"edeuup"}]],V=z("mouse-pointer-2",W),X=[{value:"horizontal",label:g.ORIENTATION_HORIZONTAL},{value:"vertical",label:g.ORIENTATION_VERTICAL}],Z=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function q(){const{currentPageId:r,setCurrentPageId:n}=S(),[e,t]=l.useState(""),I=l.useCallback(async i=>{try{const d=await(await E()).pages.getByProject(i);if(d&&d.length>0){const m=d.sort((h,f)=>{const c=new Date(h.created_at||0).getTime();return new Date(f.created_at||0).getTime()-c})[0].id;t(m),n(m)}}catch(o){console.error("‚ùå [IndexedDB] Failed to fetch current page ID:",o)}},[n]);return l.useEffect(()=>{if(r){t(r);return}const i=window.location.pathname.split("/"),o=i[i.length-1];if(o&&Z.test(o))t(o),n(o);else{const d=i[i.length-2];d&&I(d)}},[r,n,I]),{localPageId:e,storePageId:r,validatePageId:async i=>{try{return!!await(await E()).pages.getById(i)}catch(o){return console.error("‚ùå [IndexedDB] Page validation failed:",o),!1}}}}const se=l.memo(function({elementId:n,currentProps:e,onUpdate:t}){const{addElement:I,elements:T}=S(),{localPageId:i,storePageId:o}=q(),d=l.useMemo(()=>S.getState().elementsMap.get(n)?.customId||"",[n]),x=l.useCallback(a=>{t({...e,defaultSelectedKey:a||void 0})},[e,t]),m=l.useCallback(a=>{t({...e,isDisabled:a})},[e,t]),h=l.useCallback(a=>{t({...e,orientation:a})},[e,t]),f=l.useCallback(a=>{t({...e,showIndicator:a})},[e,t]),c=l.useCallback(a=>{t({...e,"aria-label":a||void 0})},[e,t]),b=l.useCallback(a=>{t({...e,"aria-labelledby":a||void 0})},[e,t]),w=l.useCallback(a=>{t({...e,"aria-describedby":a||void 0})},[e,t]),u=l.useMemo(()=>T.filter(a=>a.parent_id===n&&a.tag==="Tab").sort((a,K)=>(a.order_num||0)-(K.order_num||0)),[T,n]),C=l.useMemo(()=>u.map(a=>({id:a.id,value:a.id,label:"title"in a.props?a.props.title:"Untitled Tab"})),[u]),p=l.useCallback(async()=>{try{const a=i||o;if(!a){alert("ÌéòÏù¥ÏßÄ IDÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî.");return}await Q(u,e,n,a,t,I)}catch(a){console.error("Add tab error:",a),alert("ÌÉ≠ Ï∂îÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.")}},[i,o,u,e,n,t,I]),R=l.useMemo(()=>s.jsx(y,{title:"Basic",children:s.jsx(F,{label:"ID",value:d,elementId:n,placeholder:"tabs_1"})}),[d,n]),k=l.useMemo(()=>s.jsx(y,{title:"State",children:s.jsx(B,{label:g.DEFAULT_TAB,value:String(e.defaultSelectedKey||""),onChange:x,options:C,icon:$})}),[e.defaultSelectedKey,C,x]),M=l.useMemo(()=>s.jsx(y,{title:"Behavior",children:s.jsx(_,{label:g.DISABLED,isSelected:!!e.isDisabled,onChange:m,icon:G})}),[e.isDisabled,m]),O=l.useMemo(()=>s.jsxs(y,{title:"Design",children:[s.jsx(B,{label:g.ORIENTATION,value:String(e.orientation||"horizontal"),onChange:h,options:X,icon:J}),s.jsx(_,{label:"Show Indicator",isSelected:!!e.showIndicator,onChange:f,icon:V})]}),[e.orientation,e.showIndicator,h,f]),L=l.useMemo(()=>s.jsxs(y,{title:"Accessibility",children:[s.jsx(D,{label:g.ARIA_LABEL,value:String(e["aria-label"]||""),onChange:c,icon:H,placeholder:"Tabs label for screen readers"}),s.jsx(D,{label:g.ARIA_LABELLEDBY,value:String(e["aria-labelledby"]||""),onChange:b,icon:j,placeholder:"label-element-id"}),s.jsx(D,{label:g.ARIA_DESCRIBEDBY,value:String(e["aria-describedby"]||""),onChange:w,icon:j,placeholder:"description-element-id"})]}),[e,c,b,w]),P=l.useMemo(()=>s.jsxs(y,{title:g.TAB_MANAGEMENT,children:[s.jsxs("div",{className:"tab-overview",children:[s.jsxs("p",{className:"tab-overview-text",children:["Total tabs: ",u.length||0]}),s.jsx("p",{className:"section-overview-help",children:"üí° Select individual tabs from layer tree to edit their properties"})]}),s.jsx("div",{className:"tab-actions",children:s.jsxs("button",{className:"control-button add",onClick:p,disabled:!i&&!o,children:[s.jsx(Y,{color:A.color,strokeWidth:A.stroke,size:A.size}),g.ADD_TAB]})})]}),[u.length,p,i,o]);return s.jsxs(s.Fragment,{children:[R,k,M,O,L,P]})},(r,n)=>r.elementId===n.elementId&&JSON.stringify(r.currentProps)===JSON.stringify(n.currentProps));async function Q(r,n,e,t,I,T){const i=r.length||0,o=v.generateId(),{elements:d}=S.getState(),x=d.filter(c=>c.parent_id===e),m=Math.max(0,...x.map(c=>c.order_num||0)),h={id:v.generateId(),customId:N("Tab",d),page_id:t,tag:"Tab",props:{title:`Tab ${i+1}`,variant:"default",appearance:"light",style:{},className:"",tabId:o},parent_id:e,order_num:m+1},f={id:v.generateId(),customId:N("Panel",d),page_id:t,tag:"Panel",props:{variant:"tab",title:h.props.title,tabIndex:i,style:{},className:"",tabId:o},parent_id:e,order_num:m+2};try{const c=await E(),b=await c.elements.insert(h),w=await c.elements.insert(f),u={...n,defaultSelectedKey:r.length===0?h.id:n.defaultSelectedKey};if(S.getState().elementsMap.get(e))try{await c.elements.update(e,{props:u})}catch(p){console.warn(`‚ö†Ô∏è [IndexedDB] Failed to update Tabs element ${e}:`,p)}else console.warn(`‚ö†Ô∏è [IndexedDB] Tabs element ${e} not found in memory, skipping IndexedDB update`);I(u),T(b),T(w),console.log("‚úÖ [IndexedDB] Tab and Panel created successfully")}catch(c){console.error("‚ùå [IndexedDB] createNewTab error:",c);try{const b=await E();await b.elements.delete(h.id),await b.elements.delete(f.id),console.log("‚ö†Ô∏è [IndexedDB] Rollback completed")}catch(b){console.error("‚ùå [IndexedDB] Rollback failed:",b)}throw c}}export{se as TabsEditor};
