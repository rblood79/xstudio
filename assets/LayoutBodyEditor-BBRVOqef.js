import{D as A,r as d,aG as _,aH as H,aI as z,j as e,aJ as D,aK as M,aL as B,l as k,i as j,aM as q,a5 as I,aN as O,u as C,B as F,q as E,a6 as G,P,a as Y,b as $,c as J,H as W}from"./index-nCH8xSW_.js";import{P as R}from"./labels-C7QIhqP9.js";import{LayoutSlugEditor as X}from"./LayoutSlugEditor-lTz6U5ja.js";import"./slugValidator-DYMUhltT.js";const Q=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M12 3v18",key:"108xh3"}]],V=A("columns-2",Q);const Z=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],U=A("layout-dashboard",Z);const K=[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]],ee=A("merge",K),te=d.forwardRef(function(i,a){[i,a]=_(i,a,H);let{children:l,level:s=3,className:m,...t}=i,u=`h${s}`;return z.createElement(u,{...t,ref:a,className:m??"react-aria-Heading"},l)}),ie=d.memo(function({areas:i,width:a=120,height:l=80,selectedSlot:s}){const m=d.useMemo(()=>i.map(t=>{const u=s===t.name,h=t.required;let n;return u?n="var(--color-primary-200)":h?n="var(--color-primary-100)":t.isSlot?n="var(--color-gray-100)":n="var(--color-gray-50)",e.jsxs("g",{children:[e.jsx("rect",{x:`${t.x}%`,y:`${t.y}%`,width:`${t.width}%`,height:`${t.height}%`,fill:n,stroke:u?"var(--color-primary-500)":"var(--color-gray-300)",strokeWidth:u?2:1,rx:2}),t.width>=20&&t.height>=15&&e.jsx("text",{x:`${t.x+t.width/2}%`,y:`${t.y+t.height/2}%`,textAnchor:"middle",dominantBaseline:"middle",fill:"var(--color-gray-600)",fontSize:"8",fontFamily:"var(--font-sans)",children:t.name}),h&&t.width>=15&&e.jsx("text",{x:`${t.x+t.width-2}%`,y:`${t.y+4}%`,textAnchor:"end",fill:"var(--color-primary-600)",fontSize:"8",fontWeight:"bold",children:"*"})]},t.name)}),[i,s]);return e.jsx("svg",{width:a,height:l,viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"preset-preview-svg",style:{border:"1px solid var(--color-gray-200)",borderRadius:"var(--radius-sm)",backgroundColor:"var(--color-white)"},children:m})}),se=d.memo(function({isOpen:i,existingSlots:a,presetName:l,onConfirm:s,onClose:m}){const t=a.some(f=>f.hasChildren),u=d.useCallback(()=>{s("replace")},[s]),h=d.useCallback(()=>{s("merge")},[s]),n=d.useCallback(()=>{s("cancel"),m()},[s,m]);return i?e.jsx(D,{isOpen:i,children:e.jsx(M,{isDismissable:!0,onOpenChange:f=>!f&&m(),className:"react-aria-Modal",children:e.jsxs(B,{className:"react-aria-Dialog existing-slot-dialog",children:[e.jsxs(te,{slot:"title",className:"dialog-title",children:[e.jsx(k,{className:"icon-warning",size:j.size}),"기존 Slot이 있습니다"]}),e.jsxs("div",{className:"dialog-content",children:[e.jsxs("p",{className:"dialog-description",children:["“",l,"” 프리셋을 적용하려면 기존 Slot을 어떻게 처리할지 선택하세요."]}),e.jsxs("div",{className:"existing-slots-list",children:[e.jsxs("p",{className:"list-title",children:["현재 Slot (",a.length,"개):"]}),e.jsx("ul",{children:a.map(f=>e.jsxs("li",{children:[e.jsx("span",{className:"slot-name",children:f.slotName}),f.hasChildren&&e.jsx("span",{className:"slot-warning",children:"(콘텐츠 있음)"})]},f.elementId))})]}),t&&e.jsxs("div",{className:"warning-box",children:[e.jsx(k,{size:j.size}),e.jsx("span",{children:"일부 Slot에 콘텐츠가 있습니다. 덮어쓰기 시 삭제됩니다."})]})]}),e.jsxs("div",{className:"dialog-actions",children:[e.jsxs(q,{variant:"default",onPress:n,children:[e.jsx(I,{size:j.size}),"취소"]}),e.jsxs(q,{variant:"secondary",onPress:h,children:[e.jsx(ee,{size:j.size}),"병합 (새 Slot만 추가)"]}),e.jsxs(q,{variant:"primary",onPress:u,children:[e.jsx(O,{size:j.size}),"덮어쓰기"]})]})]})})}):null}),v={fullscreen:{id:"fullscreen",name:"전체화면",description:"단일 전체 화면 콘텐츠",category:"basic",slots:[{name:"content",required:!0,description:"전체 화면 콘텐츠"}],containerStyle:{display:"flex",minHeight:"100vh"},previewAreas:[{name:"content",x:0,y:0,width:100,height:100,isSlot:!0,required:!0}]},"vertical-2":{id:"vertical-2",name:"수직 2단",description:"Header + Content",category:"basic",slots:[{name:"header",required:!1,description:"상단 헤더 영역"},{name:"content",required:!0,description:"메인 콘텐츠 영역"}],containerStyle:{display:"flex",flexDirection:"column",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:15,isSlot:!0},{name:"content",x:0,y:15,width:100,height:85,isSlot:!0,required:!0}]},"vertical-3":{id:"vertical-3",name:"수직 3단",description:"Header + Content + Footer",category:"basic",slots:[{name:"header",required:!1,description:"상단 헤더 영역"},{name:"content",required:!0,description:"메인 콘텐츠 영역"},{name:"footer",required:!1,description:"하단 푸터 영역"}],containerStyle:{display:"flex",flexDirection:"column",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:12,isSlot:!0},{name:"content",x:0,y:12,width:100,height:76,isSlot:!0,required:!0},{name:"footer",x:0,y:88,width:100,height:12,isSlot:!0}]},"sidebar-left":{id:"sidebar-left",name:"좌측 사이드바",description:"Sidebar + Content",category:"sidebar",slots:[{name:"sidebar",required:!1,description:"좌측 사이드바",defaultStyle:{width:"250px"}},{name:"content",required:!0,description:"메인 콘텐츠"}],containerStyle:{display:"flex",flexDirection:"row",minHeight:"100vh"},previewAreas:[{name:"sidebar",x:0,y:0,width:25,height:100,isSlot:!0},{name:"content",x:25,y:0,width:75,height:100,isSlot:!0,required:!0}]},"sidebar-right":{id:"sidebar-right",name:"우측 사이드바",description:"Content + Sidebar",category:"sidebar",slots:[{name:"content",required:!0,description:"메인 콘텐츠"},{name:"sidebar",required:!1,description:"우측 사이드바",defaultStyle:{width:"250px"}}],containerStyle:{display:"flex",flexDirection:"row",minHeight:"100vh"},previewAreas:[{name:"content",x:0,y:0,width:75,height:100,isSlot:!0,required:!0},{name:"sidebar",x:75,y:0,width:25,height:100,isSlot:!0}]},"holy-grail":{id:"holy-grail",name:"Holy Grail",description:"Header + (Sidebar + Content + Aside) + Footer",category:"complex",slots:[{name:"header",required:!1},{name:"sidebar",required:!1,defaultStyle:{width:"200px"}},{name:"content",required:!0},{name:"aside",required:!1,defaultStyle:{width:"200px"}},{name:"footer",required:!1}],containerStyle:{display:"grid",gridTemplateAreas:`
        "header header header"
        "sidebar content aside"
        "footer footer footer"
      `,gridTemplateColumns:"200px 1fr 200px",gridTemplateRows:"auto 1fr auto",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:12,isSlot:!0},{name:"sidebar",x:0,y:12,width:20,height:76,isSlot:!0},{name:"content",x:20,y:12,width:60,height:76,isSlot:!0,required:!0},{name:"aside",x:80,y:12,width:20,height:76,isSlot:!0},{name:"footer",x:0,y:88,width:100,height:12,isSlot:!0}]},"complex-3col":{id:"complex-3col",name:"3열 레이아웃",description:"Header + 3 Columns + Footer",category:"complex",slots:[{name:"header",required:!1},{name:"left",required:!1},{name:"content",required:!0},{name:"right",required:!1},{name:"footer",required:!1}],containerStyle:{display:"grid",gridTemplateAreas:`
        "header header header"
        "left content right"
        "footer footer footer"
      `,gridTemplateColumns:"1fr 2fr 1fr",gridTemplateRows:"auto 1fr auto",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:12,isSlot:!0},{name:"left",x:0,y:12,width:25,height:76,isSlot:!0},{name:"content",x:25,y:12,width:50,height:76,isSlot:!0,required:!0},{name:"right",x:75,y:12,width:25,height:76,isSlot:!0},{name:"footer",x:0,y:88,width:100,height:12,isSlot:!0}]},dashboard:{id:"dashboard",name:"대시보드",description:"Navigation + Sidebar + Main Content",category:"dashboard",slots:[{name:"navigation",required:!1,description:"상단 네비게이션"},{name:"sidebar",required:!1,description:"좌측 메뉴",defaultStyle:{width:"240px"}},{name:"content",required:!0,description:"대시보드 콘텐츠"}],containerStyle:{display:"grid",gridTemplateAreas:`
        "navigation navigation"
        "sidebar content"
      `,gridTemplateColumns:"240px 1fr",gridTemplateRows:"auto 1fr",minHeight:"100vh"},previewAreas:[{name:"navigation",x:0,y:0,width:100,height:10,isSlot:!0},{name:"sidebar",x:0,y:10,width:24,height:90,isSlot:!0},{name:"content",x:24,y:10,width:76,height:90,isSlot:!0,required:!0}]},"dashboard-widgets":{id:"dashboard-widgets",name:"대시보드 (위젯)",description:"Header + Sidebar + Main + Widgets Panel",category:"dashboard",slots:[{name:"header",required:!1},{name:"sidebar",required:!1},{name:"content",required:!0},{name:"widgets",required:!1}],containerStyle:{display:"grid",gridTemplateAreas:`
        "header header header"
        "sidebar content widgets"
      `,gridTemplateColumns:"200px 1fr 280px",gridTemplateRows:"auto 1fr",minHeight:"100vh"},previewAreas:[{name:"header",x:0,y:0,width:100,height:10,isSlot:!0},{name:"sidebar",x:0,y:10,width:20,height:90,isSlot:!0},{name:"content",x:20,y:10,width:52,height:90,isSlot:!0,required:!0},{name:"widgets",x:72,y:10,width:28,height:90,isSlot:!0}]}},re={basic:{label:"기본",icon:"Layout"},sidebar:{label:"사이드바",icon:"Columns2"},complex:{label:"복합",icon:"LayoutGrid"},dashboard:{label:"대시보드",icon:"LayoutDashboard"}},ae=["fullscreen","vertical-2","vertical-3","sidebar-left","sidebar-right","holy-grail","complex-3col","dashboard","dashboard-widgets"];function le({layoutId:p,bodyElementId:i}){const[a,l]=d.useState(!1),s=C(r=>r.elements),m=C(r=>r.addComplexElement),t=C(r=>r.removeElement),u=C(r=>r.updateElementProps),h=d.useMemo(()=>s.filter(r=>r.layout_id===p&&r.tag==="Slot").map(r=>{const y=s.some(g=>g.parent_id===r.id||g.props?.slot_name===r.props?.name);return{slotName:r.props?.name||"unnamed",elementId:r.id,hasChildren:y}}),[s,p]),n=d.useMemo(()=>{const r=s.find(g=>g.id===i);if(!r)return null;const y=r.props?.appliedPreset;if(y&&v[y]){const g=v[y],S=new Set(g.slots.map(x=>x.name)),c=new Set(h.map(x=>x.slotName));if(c.size===S.size&&[...c].every(x=>S.has(x)))return y}return null},[s,i,h]),f=d.useCallback(async(r,y)=>{if(y==="cancel")return;const g=v[r];if(!g){console.error(`[usePresetApply] Unknown preset: ${r}`);return}console.log(`[Preset] Applying "${g.name}" to layout ${p.slice(0,8)}...`),l(!0);try{y==="replace"&&h.length>0&&(console.log(`[Preset] Removing ${h.length} existing slots...`),await Promise.all(h.map(o=>t(o.elementId))),console.log(`[Preset] Removed ${h.length} existing slots`));const S=new Set(h.map(o=>o.slotName)),c=y==="merge"?g.slots.filter(o=>!S.has(o.name)):g.slots;if(c.length===0){console.log("[Preset] No new slots to create (all already exist)"),l(!1);return}console.log(`[Preset] Creating ${c.length} new slots...`);let x=1;const b=c.map(o=>({id:crypto.randomUUID(),tag:"Slot",props:{name:o.name,required:o.required,description:o.description,style:o.defaultStyle},parent_id:i,layout_id:p,page_id:null,order_num:x++})),N=s.find(o=>o.id===i);if(N){const o=N.props?.style||{},w=g.containerStyle?{...o,...g.containerStyle}:o;await u(i,{style:w,appliedPreset:r}),console.log(`[Preset] Saved appliedPreset="${r}" to body`)}if(b.length>0){const[o,...w]=b;await m(o,w),console.log(`[Preset] Created ${b.length} slots with single history entry`)}console.log(`[Preset] "${g.name}" applied successfully`)}catch(S){throw console.error("[Preset] Failed to apply preset:",S),S}finally{l(!1)}},[p,i,h,s,m,t,u]);return{existingSlots:h,currentPresetKey:n,applyPreset:f,isApplying:a}}const ne={basic:E,sidebar:V,complex:F,dashboard:U},oe=d.memo(function({layoutId:i,bodyElementId:a}){const[l,s]=d.useState(null),[m,t]=d.useState(!1),{existingSlots:u,currentPresetKey:h,applyPreset:n,isApplying:f}=le({layoutId:i,bodyElementId:a}),r=d.useMemo(()=>{const c={basic:[],sidebar:[],complex:[],dashboard:[]};return ae.forEach(x=>{const b=v[x];b&&c[b.category].push(x)}),c},[]),y=d.useCallback(c=>{if(h===c){console.log(`[Preset] "${c}" is already applied, skipping`);return}s(c),u.length>0?t(!0):n(c,"replace")},[u.length,h,n]),g=d.useCallback(c=>{l&&c!=="cancel"&&n(l,c),t(!1),s(null)},[l,n]),S=d.useCallback(()=>{t(!1),s(null)},[]);return e.jsxs(e.Fragment,{children:[Object.entries(re).map(([c,x])=>{const b=r[c];if(!b||b.length===0)return null;const N=ne[c]||E;return e.jsxs("div",{className:"list-subgroup",children:[e.jsxs("div",{className:"list-subgroup-header",children:[e.jsx(N,{size:G.size,className:"list-subgroup-icon"}),e.jsx("span",{className:"list-subgroup-title",children:x.label})]}),e.jsx("div",{className:"list-group",role:"list",children:b.map(o=>{const w=v[o];if(!w)return null;const T=l===o,L=h===o;return e.jsxs(q,{variant:"default",className:`list-item preset-card ${T?"selected":""} ${L?"applied":""}`,onPress:()=>y(o),isDisabled:f,children:[e.jsx(ie,{areas:w.previewAreas,width:80,height:60}),e.jsx("span",{className:"list-item-name",children:w.name}),L&&e.jsx("span",{className:"list-item-badge applied",children:"적용됨"})]},o)})})]},c)}),e.jsx(se,{isOpen:m,existingSlots:u,presetName:l&&v[l]?.name||"",onConfirm:g,onClose:S})]})}),ue=d.memo(function({elementId:i,currentProps:a,onUpdate:l}){const{customId:s,layoutId:m}=d.useMemo(()=>{const n=C.getState().elementsMap.get(i);return{customId:n?.customId||"",layoutId:n?.layout_id||null}},[i]),t=d.useCallback(n=>{l({...a,className:n||void 0})},[a,l]),u=d.useCallback(n=>{l({...a,"aria-label":n||void 0})},[a,l]),h=d.useCallback(n=>{l({...a,"aria-labelledby":n||void 0})},[a,l]);return e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Basic",children:e.jsx(Y,{label:"ID",value:s,elementId:i,placeholder:"layout-body"})}),m&&e.jsx(P,{title:"Layout Preset",children:e.jsx(oe,{layoutId:m,bodyElementId:i})}),m&&e.jsx(X,{layoutId:m}),e.jsx(P,{title:"Layout",children:e.jsx($,{label:"Class Name",value:String(a.className||""),onChange:t,placeholder:"layout-container",icon:E})}),e.jsxs(P,{title:"Accessibility",children:[e.jsx($,{label:R.ARIA_LABEL,value:String(a["aria-label"]||""),onChange:u,icon:J,placeholder:"Layout content area"}),e.jsx($,{label:R.ARIA_LABELLEDBY,value:String(a["aria-labelledby"]||""),onChange:h,icon:W,placeholder:"ID of labeling element"})]})]})},(p,i)=>p.elementId===i.elementId&&JSON.stringify(p.currentProps)===JSON.stringify(i.currentProps));export{ue as LayoutBodyEditor,ue as default};
