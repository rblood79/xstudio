import{r as d,u as p,a0 as T,ab as k,ac as S,ad as D,h as v,a2 as F,a3 as x,j as i,P as G,ae as b,e as M,b as U,v as L,a4 as $}from"./index-CMpD_Ir5.js";const w=5,B=d.memo(function({pageId:l}){const a=p(e=>e.pages.find(t=>t.id===l)),n=p(e=>e.pages),f=T(e=>e.layouts),[y,P]=d.useState(null),_=a?.parent_id||"",j=d.useMemo(()=>n.find(e=>e.id===_),[n,_]),m=a?.slug||"",C=d.useMemo(()=>{if(!a)return"/";const e=a.layout_id?f.find(t=>t.id===a.layout_id):null;return k({page:{id:a.id,title:a.title,slug:a.slug,project_id:a.project_id,parent_id:a.parent_id,layout_id:a.layout_id,order_num:a.order_num},layout:e?{id:e.id,name:e.name,project_id:e.project_id,slug:e.slug||void 0}:null,allPages:n.map(t=>({id:t.id,title:t.title,slug:t.slug,project_id:t.project_id,parent_id:t.parent_id,layout_id:t.layout_id,order_num:t.order_num}))})},[a,n,f]),N=d.useMemo(()=>{const e=[{value:"",label:"No Parent (Root)"}],t=s=>{const g=n.filter(o=>o.parent_id===s),u=g.map(o=>o.id);return g.forEach(o=>{u.push(...t(o.id))}),u},c=t(l);return n.forEach(s=>{if(s.id===l||c.includes(s.id)||S(s.id,n.map(r=>({id:r.id,title:r.title,slug:r.slug,project_id:r.project_id,parent_id:r.parent_id,layout_id:r.layout_id,order_num:r.order_num})))+1>=w)return;const u=S(s.id,n.map(r=>({id:r.id,title:r.title,slug:r.slug,project_id:r.project_id,parent_id:r.parent_id,layout_id:r.layout_id,order_num:r.order_num}))),o="  ".repeat(u);e.push({value:s.id,label:`${o}${s.title}`})}),e},[n,l]),E=d.useCallback(async e=>{if(e&&D(l,e,n.map(t=>({id:t.id,title:t.title,slug:t.slug,project_id:t.project_id,parent_id:t.parent_id,layout_id:t.layout_id,order_num:t.order_num})))){console.error("âŒ Circular reference detected");return}console.log("ðŸ”— Page Parent changed:",{pageId:l,oldParentId:_,newParentId:e||null});try{const{pages:t,setPages:c}=p.getState(),s=await v(),g=t.map(u=>u.id===l?{...u,parent_id:e||null}:u);c(g),await s.pages.update(l,{parent_id:e||null}),console.log("âœ… Page parent updated successfully")}catch(t){console.error("âŒ Failed to update page parent:",t)}},[l,_,n]),h=d.useCallback(async e=>{const t=F(e);if(!t.valid){P(t.error||"Invalid slug");return}P(null),console.log("ðŸ“ Page Slug changed:",{pageId:l,oldSlug:m,newSlug:e||null});try{const{pages:c,setPages:s}=p.getState(),g=await v(),u=c.map(o=>o.id===l?{...o,slug:e||""}:o);s(u),await g.pages.update(l,{slug:e||""}),console.log("âœ… Page slug updated successfully")}catch(c){console.error("âŒ Failed to update page slug:",c)}},[l,m]),R=d.useCallback(()=>{if(!a)return;const e=x(a.title);h(e)},[a,h]);return a?i.jsxs(G,{title:"Nested Routes",icon:b,children:[i.jsx(M,{label:"Parent Page",value:_,onChange:E,options:N,icon:b,description:j?`Child of "${j.title}"`:"This page is at root level"}),i.jsxs("div",{className:"page-slug-input",children:[i.jsx(U,{label:"Slug",value:m,onChange:h,placeholder:x(a.title),description:"URL path segment for this page"}),y&&i.jsxs("div",{className:"page-slug-error",children:[i.jsx(L,{size:$.size}),i.jsx("span",{children:y})]}),i.jsx("button",{type:"button",className:"page-slug-generate",onClick:R,title:"Generate slug from title",children:"Generate from Title"})]}),i.jsxs("div",{className:"page-url-preview",children:[i.jsx("span",{className:"page-url-label",children:"Preview URL:"}),i.jsx("code",{className:"page-url-value",children:C})]})]}):null});export{B as PageParentSelector,B as default};
