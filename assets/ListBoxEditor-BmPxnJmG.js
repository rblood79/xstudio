import{x as Le,r as t,u as x,ai as Fe,g as se,E as ne,f as oe,j as l,P as u,a as ye,b as g,T as ce,F as Me,k as we,c as de,aj as Ae,d as I,q as Te,ak as _e,R as Oe,al as re,a5 as Re,w as Ve,D as ze,z as $e,am as qe,i as C,e as Ge,H as me,S as We,t as He}from"./index-BkGgeLCq.js";import{P as o}from"./labels-C7QIhqP9.js";import{u as Ye}from"./useCollectionItemManager-PZS1_o60.js";import{S as Je}from"./square-x-CqeVF7l-.js";import{P as he}from"./pointer-off-BWq5QhsC.js";import{F as Qe}from"./focus-BQwu2LzP.js";import{B as Xe}from"./binary-BPA-AG5T.js";const Ze=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 12h18",key:"1i2n21"}]],Ke=Le("rows-2",Ze),sa=t.memo(function({elementId:c,currentProps:a,onUpdate:s}){const{children:d,selectedItemIndex:F,selectItem:y,deselectItem:B,addItem:M,deleteItem:ge,updateItem:f}=Ye({elementId:c,childTag:"ListBoxItem",defaultItemProps:e=>({label:`Item ${e+1}`,value:`item${e+1}`})}),w=t.useMemo(()=>x.getState().elementsMap.get(c)?.customId||"",[c]),k=x(e=>e.addElement),A=x(e=>e.removeElement),T=x(e=>e.currentPageId),N=t.useMemo(()=>{const e=a.dataBinding;return!e||e.source!=="dataTable"||!e.name?null:e.name},[a.dataBinding]),_=Fe(),r=t.useMemo(()=>N&&_.find(e=>e.name===N)||null,[_,N])?.schema||null,be=t.useCallback(()=>x.getState().elements.filter(e=>e.parent_id===c),[c]),j=be().find(i=>i.tag==="ListBoxItem"),m=j?.id?x.getState().elements.filter(e=>e.parent_id===j.id&&e.tag==="Field").sort((e,i)=>(e.order_num||0)-(i.order_num||0)):[],O=t.useCallback((e,i)=>{const n=e.toLowerCase();return n.includes("email")?"email":n.includes("url")||n.includes("link")||n.includes("website")?"url":n.includes("avatar")||n.includes("image")||n.includes("photo")||n.includes("picture")?"image":n.includes("date")||n.includes("created")||n.includes("updated")||n.includes("time")?"date":i==="boolean"?"boolean":i==="number"?"number":i==="date"||i==="datetime"?"date":i==="email"?"email":i==="url"?"url":i==="image"?"image":"string"},[]),R=t.useCallback(async()=>{if(!r||r.length===0){alert("DataTableì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");return}const e=T;if(!e){alert("íŽ˜ì´ì§€ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.");return}let i=j?.id;if(!i){const{elements:h}=x.getState(),D=Math.max(0,...d.map(S=>S.order_num||0)),L={id:ne.generateId(),customId:se("ListBoxItem",h),page_id:e,tag:"ListBoxItem",props:{style:{},className:""},parent_id:c,order_num:D+1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};try{const te=await(await oe()).elements.insert(L);k(te),i=te.id,console.log("âœ… [IndexedDB] ListBoxItem created for auto-generate")}catch(S){console.error("âŒ [IndexedDB] Failed to create ListBoxItem:",S),alert("ListBoxItem ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");return}}if(m.length>0&&!window.confirm(`ê¸°ì¡´ ${m.length}ê°œì˜ Fieldê°€ ìžˆìŠµë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±í•˜ë©´ ê¸°ì¡´ FieldëŠ” ìœ ì§€ë©ë‹ˆë‹¤.
ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;const{elements:n}=x.getState(),b=await oe();let v=m.length>0?Math.max(...m.map(h=>h.order_num||0))+1:1;for(const h of r){const D=O(h.key,h.type),L={id:ne.generateId(),customId:se("Field",n),page_id:e,tag:"Field",props:{key:h.key,label:h.label||h.key,type:D,showLabel:!0,visible:!0,style:{},className:""},parent_id:i,order_num:v++,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};try{const S=await b.elements.insert(L);k(S)}catch(S){console.error(`âŒ [IndexedDB] Failed to create Field for ${h.key}:`,S)}}console.log(`âœ… [Auto-Generate] ${r.length}ê°œì˜ Fieldê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`),alert(`${r.length}ê°œì˜ Fieldê°€ ìžë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`)},[r,T,j,m,d,c,k,O]);t.useEffect(()=>{B()},[c,B]);const V=t.useCallback(e=>{s({...a,label:e||void 0})},[a,s]),z=t.useCallback(e=>{s({...a,description:e||void 0})},[a,s]),$=t.useCallback(e=>{s({...a,errorMessage:e||void 0})},[a,s]),q=t.useCallback(e=>{s({...a,selectionMode:e})},[a,s]),G=t.useCallback(e=>{s({...a,disallowEmptySelection:e})},[a,s]),W=t.useCallback(e=>{s({...a,isRequired:e})},[a,s]),H=t.useCallback(e=>{s({...a,isDisabled:e})},[a,s]),Y=t.useCallback(e=>{s({...a,autoFocus:e})},[a,s]),J=t.useCallback(e=>{s({...a,name:e||void 0})},[a,s]),Q=t.useCallback(e=>{s({...a,validationBehavior:e})},[a,s]),X=t.useCallback(e=>{s({...a,"aria-label":e||void 0})},[a,s]),Z=t.useCallback(e=>{s({...a,"aria-labelledby":e||void 0})},[a,s]),K=t.useCallback(e=>{s({...a,"aria-describedby":e||void 0})},[a,s]),p=t.useCallback(async e=>{const i=a.dataBinding,n=i?.source==="dataTable"?i.name:null,b=e?.source==="dataTable"?e.name:null;if(n&&b&&n!==b&&m.length>0&&window.confirm(`DataTableì´ "${n}"ì—ì„œ "${b}"ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
ê¸°ì¡´ ${m.length}ê°œì˜ Fieldë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?

[í™•ì¸]: Field ì‚­ì œ í›„ ìƒˆ DataTable ì ìš©
[ì·¨ì†Œ]: Field ìœ ì§€í•˜ê³  DataTableë§Œ ë³€ê²½`)){for(const h of m)await A(h.id);console.log(`ðŸ—‘ï¸ [DataBinding] ${m.length}ê°œì˜ Fieldê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`)}s({...a,dataBinding:e||void 0})},[a,s,m,A]),U=t.useCallback(e=>{s({...a,enableVirtualization:e})},[a,s]),P=t.useCallback(e=>{const i=parseInt(e,10);!isNaN(i)&&i>0&&s({...a,height:i})},[a,s]),ee=t.useCallback(e=>{const i=parseInt(e,10);!isNaN(i)&&i>=0&&s({...a,overscan:i})},[a,s]),ae=t.useCallback(e=>{s({...a,filterText:e||void 0})},[a,s]),le=t.useCallback(e=>{const i=e.split(",").map(n=>n.trim()).filter(n=>n.length>0);s({...a,filterFields:i.length>0?i:void 0})},[a,s]),ie=t.useCallback(e=>{const i=x.getState().updateElement;i&&c&&i(c,{customId:e})},[c]),ue=t.useCallback((e,i)=>{const n=d.find(v=>v.id===e);if(!n)return;const b={...n.props,label:i};f(e,b)},[d,f]),xe=t.useCallback((e,i)=>{const n=d.find(v=>v.id===e);if(!n)return;const b={...n.props,value:i};f(e,b)},[d,f]),Ce=t.useCallback((e,i)=>{const n=d.find(v=>v.id===e);if(!n)return;const b={...n.props,isDisabled:i};f(e,b)},[d,f]),ve=t.useMemo(()=>l.jsx(u,{title:"Basic",children:l.jsx(ye,{label:"ID",value:w,elementId:c,onChange:ie,placeholder:"listbox_1"})}),[w,c,ie]),Se=t.useMemo(()=>l.jsxs(u,{title:"Content",children:[l.jsx(g,{label:o.LABEL,value:String(a.label||""),onChange:V,icon:ce}),l.jsx(g,{label:o.DESCRIPTION,value:String(a.description||""),onChange:z,icon:Me}),l.jsx(g,{label:o.ERROR_MESSAGE,value:String(a.errorMessage||""),onChange:$,icon:we})]}),[a.label,a.description,a.errorMessage,V,z,$]),fe=t.useMemo(()=>l.jsxs(u,{title:"State",children:[l.jsx(de,{label:o.SELECTION_MODE,value:String(a.selectionMode||"single"),onChange:q,options:[{value:"single",label:o.SELECTION_MODE_SINGLE},{value:"multiple",label:o.SELECTION_MODE_MULTIPLE}],icon:Ae}),l.jsx(I,{label:o.DISALLOW_EMPTY_SELECTION,isSelected:!!a.disallowEmptySelection,onChange:G,icon:Je}),l.jsx(I,{label:o.REQUIRED,isSelected:!!a.isRequired,onChange:W,icon:Te})]}),[a.selectionMode,a.disallowEmptySelection,a.isRequired,q,G,W]),Ie=t.useMemo(()=>l.jsxs(u,{title:"Behavior",children:[l.jsx(I,{label:o.DISABLED,isSelected:!!a.isDisabled,onChange:H,icon:he}),l.jsx(I,{label:o.AUTO_FOCUS,isSelected:!!a.autoFocus,onChange:Y,icon:Qe})]}),[a.isDisabled,a.autoFocus,H,Y]),je=t.useMemo(()=>l.jsxs(u,{title:"Performance",children:[l.jsx(I,{label:"ê°€ìƒí™” í™œì„±í™”",isSelected:!!a.enableVirtualization,onChange:U,icon:_e}),a.enableVirtualization&&l.jsxs(l.Fragment,{children:[l.jsx(g,{label:"ì»¨í…Œì´ë„ˆ ë†’ì´ (px)",value:String(a.height||300),onChange:P,icon:Oe,placeholder:"300"}),l.jsx(g,{label:"Overscan (ì¶”ê°€ ë Œë”)",value:String(a.overscan||5),onChange:ee,icon:Ke,placeholder:"5"}),l.jsx("p",{className:"section-overview-help",children:"ðŸ’¡ ê°€ìƒí™” í™œì„±í™” ì‹œ 10,000+ ì•„ì´í…œë„ ì›í™œí•˜ê²Œ ì²˜ë¦¬ë©ë‹ˆë‹¤"})]})]}),[a.enableVirtualization,a.height,a.overscan,U,P,ee]),Ee=t.useMemo(()=>l.jsxs(u,{title:"Filtering",icon:re,children:[l.jsx(g,{label:"í•„í„° í…ìŠ¤íŠ¸",value:String(a.filterText||""),onChange:ae,icon:Re,placeholder:"ê²€ìƒ‰ì–´ ìž…ë ¥..."}),l.jsx(g,{label:"í•„í„° ëŒ€ìƒ í•„ë“œ",value:Array.isArray(a.filterFields)?a.filterFields.join(", "):"",onChange:le,icon:re,placeholder:"label, name, title"}),l.jsx("p",{className:"section-overview-help",children:"ðŸ’¡ í•„í„° ëŒ€ìƒ í•„ë“œê°€ ë¹„ì–´ìžˆìœ¼ë©´ ê¸°ë³¸ê°’ (label, name, title) ì‚¬ìš©"})]}),[a.filterText,a.filterFields,ae,le]),Be=t.useMemo(()=>l.jsxs(u,{title:"Form Integration",children:[l.jsx(g,{label:o.NAME,value:String(a.name||""),onChange:J,icon:Ve,placeholder:"listbox-name"}),l.jsx(de,{label:o.VALIDATION_BEHAVIOR,value:String(a.validationBehavior||"native"),onChange:Q,options:[{value:"native",label:"Native"},{value:"aria",label:"ARIA"}]})]}),[a.name,a.validationBehavior,J,Q]),ke=t.useMemo(()=>l.jsxs(u,{title:"Data Binding",icon:ze,children:[l.jsx($e,{label:"ë°ì´í„° ì†ŒìŠ¤",value:a.dataBinding,onChange:p}),r&&r.length>0&&l.jsxs("div",{className:"auto-generate-section",children:[l.jsxs("div",{className:"schema-info",children:[l.jsxs("p",{className:"tab-overview-text",children:["ðŸ“‹ ",r.length,"ê°œì˜ ì»¬ëŸ¼ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤"]}),l.jsxs("div",{className:"schema-columns",children:[r.slice(0,5).map(e=>l.jsxs("span",{className:"schema-column-tag",children:[e.label||e.key," (",e.type,")"]},e.key)),r.length>5&&l.jsxs("span",{className:"schema-column-more",children:["+",r.length-5,"ê°œ ë”"]})]})]}),l.jsx("div",{className:"tab-actions",children:l.jsxs("button",{className:"control-button add",onClick:R,children:[l.jsx(qe,{color:C.color,strokeWidth:C.stroke,size:C.size}),"Field ìžë™ ìƒì„±"]})}),m.length>0&&l.jsxs("p",{className:"section-overview-help",children:["âœ… í˜„ìž¬ ",m.length,"ê°œì˜ Fieldê°€ ìžˆìŠµë‹ˆë‹¤"]})]})]}),[a.dataBinding,p,r,m,R]),Ne=t.useMemo(()=>l.jsxs(u,{title:"Accessibility",children:[l.jsx(g,{label:o.ARIA_LABEL,value:String(a["aria-label"]||""),onChange:X,icon:Ge,placeholder:"ListBox label for screen readers"}),l.jsx(g,{label:o.ARIA_LABELLEDBY,value:String(a["aria-labelledby"]||""),onChange:Z,icon:me,placeholder:"label-element-id"}),l.jsx(g,{label:o.ARIA_DESCRIBEDBY,value:String(a["aria-describedby"]||""),onChange:K,icon:me,placeholder:"description-element-id"})]}),[a,X,Z,K]),De=t.useMemo(()=>l.jsxs(u,{title:o.ITEM_MANAGEMENT,children:[l.jsxs("div",{className:"tab-overview",children:[l.jsxs("p",{className:"tab-overview-text",children:["Total items: ",d.length||0]}),l.jsx("p",{className:"section-overview-help",children:"ðŸ’¡ Select individual items from list to edit label, value, and state"})]}),d.length>0&&l.jsx("div",{className:"react-aria-ListBox",children:d.map((e,i)=>l.jsxs("div",{className:"react-aria-ListBoxItem",children:[l.jsx("span",{className:"tab-title",children:String(e.props.label||`Item ${i+1}`)}),l.jsx("button",{className:"tab-edit-button",onClick:()=>y(i),children:"Edit"})]},e.id))}),l.jsx("div",{className:"tab-actions",children:l.jsxs("button",{className:"control-button add",onClick:M,children:[l.jsx(We,{color:C.color,strokeWidth:C.stroke,size:C.size}),"Add Item"]})})]}),[d,y,M]);if(F!==null){const e=d[F];return e?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"properties-aria",children:[l.jsx(g,{label:o.LABEL,value:String(e.props.label||""),onChange:i=>ue(e.id,i),icon:ce}),l.jsx(g,{label:o.VALUE,value:String(e.props.value||""),onChange:i=>xe(e.id,i),icon:Xe}),l.jsx(I,{label:o.DISABLED,isSelected:!!e.props.isDisabled,onChange:i=>Ce(e.id,i),icon:he}),l.jsx("div",{className:"tab-actions",children:l.jsxs("button",{className:"control-button delete",onClick:()=>ge(e.id),children:[l.jsx(He,{color:C.color,strokeWidth:C.stroke,size:C.size}),"Delete This Item"]})})]}),l.jsx("div",{className:"tab-actions",children:l.jsx("button",{className:"control-button secondary",onClick:B,children:"Back to ListBox Settings"})})]}):null}return l.jsxs(l.Fragment,{children:[ve,Se,ke,je,Ee,fe,Ie,Be,Ne,De]})},(E,c)=>E.elementId===c.elementId&&JSON.stringify(E.currentProps)===JSON.stringify(c.currentProps));export{sa as ListBoxEditor};
